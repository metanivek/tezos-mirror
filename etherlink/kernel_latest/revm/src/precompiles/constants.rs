// SPDX-FileCopyrightText: 2025 Nomadic Labs <contact@nomadic-labs.com>
// SPDX-FileCopyrightText: 2025 Functori <contact@functori.com>
//
// SPDX-License-Identifier: MIT

use revm::primitives::{Address, FixedBytes};

pub(crate) const WITHDRAWAL_SOL_CONTRACT: &str = "0x60806040526004361015610013575b61037d565b61001d5f3561004c565b806320d786b51461004757806367a32cd7146100425763cda4fee20361000e57610354565b6102f5565b6100cf565b60e01c90565b60405190565b5f80fd5b5f80fd5b5f91031261006a57565b61005c565b1c90565b90565b61008690600861008b930261006f565b610073565b90565b906100999154610076565b90565b6100a75f5f9061008e565b90565b90565b6100b6906100aa565b9052565b91906100cd905f602085019401906100ad565b565b346100ff576100df366004610060565b6100fb6100ea61009c565b6100f2610052565b918291826100ba565b0390f35b610058565b5f80fd5b5f80fd5b5f80fd5b601f801991011690565b634e487b7160e01b5f52604160045260245ffd5b9061013890610110565b810190811067ffffffffffffffff82111761015257604052565b61011a565b9061016a610163610052565b928361012e565b565b67ffffffffffffffff811161018a57610186602091610110565b0190565b61011a565b90825f939282370152565b909291926101af6101aa8261016c565b610157565b938185526020850190828401116101cb576101c99261018f565b565b61010c565b9080601f830112156101ee578160206101eb9335910161019a565b90565b610108565b67ffffffffffffffff81116102115761020d602091610110565b0190565b61011a565b9092919261022b610226826101f3565b610157565b93818552602085019082840111610247576102459261018f565b565b61010c565b9080601f8301121561026a5781602061026793359101610216565b90565b610108565b916060838303126102eb575f83013567ffffffffffffffff81116102e657826102999185016101d0565b92602081013567ffffffffffffffff81116102e157836102ba9183016101d0565b92604082013567ffffffffffffffff81116102dc576102d9920161024c565b90565b610104565b610104565b610104565b61005c565b5f0190565b61030961030336600461026f565b916109d3565b610311610052565b8061031b816102f0565b0390f35b9060208282031261034f575f82013567ffffffffffffffff811161034a5761034792016101d0565b90565b610104565b61005c565b61036761036236600461031f565b610b84565b61036f610052565b80610379816102f0565b0390f35b5f80fd5b5f1c90565b60ff1690565b61039861039d91610381565b610386565b90565b6103aa905c61038c565b90565b151590565b60209181520190565b5f7f5265656e7472616e6379206973206e6f7420616c6c6f77656400000000000000910152565b6103ef60196020926103b2565b6103f8816103bb565b0190565b6104119060208101905f8183039101526103e2565b90565b1561041b57565b610423610052565b62461bcd60e51b815280610439600482016103fc565b0390fd5b5f1b90565b9061044e60ff9161043d565b9181191691161790565b610461906103ad565b90565b90565b9061047c61047761048392610458565b610464565b825c610442565b905d565b906104b792916104a76104a261049c5f6103a0565b156103ad565b610414565b6104b260015f610467565b6108bd565b6104c15f5f610467565b565b6104cf6104d491610381565b610073565b90565b6104e190546104c3565b90565b5190565b90825f9392825e0152565b61051261051b60209361052093610509816104e4565b938480936103b2565b958691016104e8565b610110565b0190565b5190565b60209181520190565b61055061055960209361055e9361054781610524565b93848093610528565b958691016104e8565b610110565b0190565b906105a76105b99597969461059960809561058b6105b29560a08801908882035f8a01526104f3565b9086820360208801526104f3565b908482036040860152610531565b9660608301906100ad565b01906100ad565b565b600360ff60981b0190565b906105d86105d3836101f3565b610157565b918252565b606090565b3d5f146105fd576105f23d6105c6565b903d5f602084013e5b565b6106056105dd565b906105fb565b5f7f43616c6c20746f20746865206f7574626f782073656e646572206661696c6564910152565b61063e602080926103b2565b6106478161060b565b0190565b6106609060208101905f818303910152610632565b90565b1561066a57565b610672610052565b62461bcd60e51b8152806106886004820161064b565b0390fd5b61dead90565b905090565b6106a25f8092610692565b0190565b6106af90610697565b90565b5f7f4661696c656420746f206275726e000000000000000000000000000000000000910152565b6106e6600e6020926103b2565b6106ef816106b2565b0190565b6107089060208101905f8183039101526106d9565b90565b1561071257565b61071a610052565b62461bcd60e51b815280610730600482016106f3565b0390fd5b60200190565b69ffffffffffffffffffff191690565b610754905161073a565b90565b1b90565b61077561077061076a83610524565b92610734565b61074a565b9060168110610783575b5090565b61079f9069ffffffffffffffffffff1990601603600802610757565b165f61077f565b6107af9061073a565b9052565b60018060a01b031690565b6107c7906107b3565b90565b6107d3906107be565b9052565b9695939461081e6108339661081460a09661080a61082b9760208e61080360c082019a5f8301906107a6565b01906100ad565b60408c01906100ad565b60608a01906100ad565b8782036080890152610531565b9401906107ca565b565b634e487b7160e01b5f52601160045260245ffd5b610852906100aa565b5f1981146108605760010190565b610835565b906108715f199161043d565b9181191691161790565b90565b61089261088d610897926100aa565b61087b565b6100aa565b90565b90565b906108b26108ad6108b99261087e565b61089a565b8254610865565b9055565b5f8061096f9261091334956109046108d488610d8a565b93919389906108e2876104d7565b916108eb610052565b968795600460208801631be3287960e31b815201610562565b6020820181038252038261012e565b61091b6105bb565b9082602082019151925af16109376109316105e2565b91610663565b61096a5f8061094461068c565b8661094d610052565b9081610958816106a6565b03925af16109646105e2565b5061070b565b61075b565b6109b461097b5f6104d7565b9293429033917f62e8e01e31b83084b97c32b1b11ad5a2042382f5f65ee4106ad4a0d0f8b9942c966109ab610052565b968796876107d7565b0390a16109d16109cb6109c65f6104d7565b610849565b5f61089d565b565b906109de9291610487565b565b610a0e906109fe6109f96109f35f6103a0565b156103ad565b610414565b610a0960015f610467565b610a7e565b610a185f5f610467565b565b92916020610a36610a3e9360408701908782035f8901526104f3565b9401906100ad565b565b610a75610a7c94610a6b606094989795610a61608086019a5f8701906100ad565b60208501906107ca565b60408301906107a6565b01906100ad565b565b5f803492610ac2610a8e85610d8a565b91610ab3610a9a610052565b938492600460208501631ef3b63960e21b815201610a1a565b6020820181038252038261012e565b610aca6105bb565b9082602082019151925af190610ae7610ae16105e2565b92610663565b610b1a5f80610af461068c565b84610afd610052565b9081610b08816106a6565b03925af1610b146105e2565b5061070b565b90610b25339161075b565b91610b65610b325f6104d7565b7f2d5ad793181f5b6bd727c0c216461e019ecfe466353fdde9ccf813f45b84fa8294610b5c610052565b94859485610a40565b0390a1610b82610b7c610b775f6104d7565b610849565b5f61089d565b565b610b8d906109e0565b565b5f90565b90565b610baa610ba5610baf92610b93565b61087b565b6100aa565b90565b610bc064e8d4a51000610b96565b90565b634e487b7160e01b5f52601260045260245ffd5b610be3610be9916100aa565b916100aa565b908115610bf4570490565b610bc3565b610c05610c0b916100aa565b916100aa565b908115610c16570690565b610bc3565b90565b610c32610c2d610c3792610c1b565b61087b565b6100aa565b90565b5f7f416d6f756e74206973207a65726f000000000000000000000000000000000000910152565b610c6e600e6020926103b2565b610c7781610c3a565b0190565b610c909060208101905f818303910152610c61565b90565b15610c9a57565b610ca2610052565b62461bcd60e51b815280610cb860048201610c7b565b0390fd5b60407f657a290000000000000000000000000000000000000000000000000000000000917f526f756e64696e6720776f756c64206c6f7365207765692c20616d6f756e74205f8201527f6d757374206265206d756c7469706c65206f662031305e3132202831206d757460208201520152565b610d3c60436060926103b2565b610d4581610cbc565b0190565b610d5e9060208101905f818303910152610d2f565b90565b15610d6857565b610d70610052565b62461bcd60e51b815280610d8660048201610d49565b0390fd5b610d92610b8f565b50610def610da882610da2610bb2565b90610bd7565b91610dd7610dbe82610db8610bb2565b90610bf9565b91610dd1610dcb5f610c1e565b916100aa565b11610c93565b610de9610de35f610c1e565b916100aa565b14610d61565b9056fea264697066735822122052822af985bf52e3d04de58e37f65993ad0c7af631731e6ae48a2458bf3f1b3964736f6c634300081d0033";

pub(crate) const FA_WITHDRAWAL_SOL_CONTRACT: &str = "0x60806040526004361015610013575b610510565b61001d5f3561005c565b806320d786b514610057578063379607f51461005257806380fc1fe31461004d5763fff7ca5f0361000e576104e0565b610366565b61015e565b6100df565b60e01c90565b60405190565b5f80fd5b5f80fd5b5f91031261007a57565b61006c565b1c90565b90565b61009690600861009b930261007f565b610083565b90565b906100a99154610086565b90565b6100b75f5f9061009e565b90565b90565b6100c6906100ba565b9052565b91906100dd905f602085019401906100bd565b565b3461010f576100ef366004610070565b61010b6100fa6100ac565b610102610062565b918291826100ca565b0390f35b610068565b5f80fd5b610121816100ba565b0361012857565b5f80fd5b9050359061013982610118565b565b9060208282031261015457610151915f0161012c565b90565b61006c565b5f0190565b61017161016c36600461013b565b610eb5565b610179610062565b8061018381610159565b0390f35b60018060a01b031690565b61019b90610187565b90565b6101a781610192565b036101ae57565b5f80fd5b905035906101bf8261019e565b565b5f80fd5b5f80fd5b601f801991011690565b634e487b7160e01b5f52604160045260245ffd5b906101f1906101c9565b810190811067ffffffffffffffff82111761020b57604052565b6101d3565b9061022361021c610062565b92836101e7565b565b67ffffffffffffffff81116102435761023f6020916101c9565b0190565b6101d3565b90825f939282370152565b9092919261026861026382610225565b610210565b938185526020850190828401116102845761028292610248565b565b6101c5565b9080601f830112156102a7578160206102a493359101610253565b90565b6101c1565b69ffffffffffffffffffff191690565b6102c5816102ac565b036102cc57565b5f80fd5b905035906102dd826102bc565b565b91909160a081840312610361576102f8835f83016101b2565b92602082013567ffffffffffffffff811161035c5781610319918401610289565b92610327826040850161012c565b9261033583606083016102d0565b92608082013567ffffffffffffffff8111610357576103549201610289565b90565b610114565b610114565b61006c565b61037d6103743660046102df565b9392909261165c565b610385610062565b8061038f81610159565b0390f35b67ffffffffffffffff81116103b1576103ad6020916101c9565b0190565b6101d3565b909291926103cb6103c682610393565b610210565b938185526020850190828401116103e7576103e592610248565b565b6101c5565b9080601f8301121561040a57816020610407933591016103b6565b90565b6101c1565b9060e0828203126104db57610426815f84016101b2565b92602083013567ffffffffffffffff81116104d65782610447918501610289565b92610455836040830161012c565b9261046381606084016102d0565b92608083013567ffffffffffffffff81116104d15782610484918501610289565b9260a081013567ffffffffffffffff81116104cc57836104a59183016103ec565b9260c082013567ffffffffffffffff81116104c7576104c49201610289565b90565b610114565b610114565b610114565b610114565b61006c565b6104fa6104ee36600461040f565b95949094939193611af0565b610502610062565b8061050c81610159565b0390f35b5f80fd5b5f1c90565b60ff1690565b61052b61053091610514565b610519565b90565b61053d905c61051f565b90565b151590565b60209181520190565b5f7f5265656e7472616e6379206973206e6f7420616c6c6f77656400000000000000910152565b6105826019602092610545565b61058b8161054e565b0190565b6105a49060208101905f818303910152610575565b90565b156105ae57565b6105b6610062565b62461bcd60e51b8152806105cc6004820161058f565b0390fd5b5f1b90565b906105e160ff916105d0565b9181191691161790565b6105f490610540565b90565b90565b9061060f61060a610616926105eb565b6105f7565b825c6105d5565b905d565b6106489061063861063361062d5f610533565b15610540565b6105a7565b61064360015f6105fa565b610bea565b6106525f5f6105fa565b565b600460ff60981b0190565b9061067161066c83610225565b610210565b918252565b606090565b3d5f146106965761068b3d61065f565b903d5f602084013e5b565b61069e610676565b90610694565b5f7f436f756c64206e6f742066696e64206465706f73697400000000000000000000910152565b6106d86016602092610545565b6106e1816106a4565b0190565b6106fa9060208101905f8183039101526106cb565b90565b1561070457565b61070c610062565b62461bcd60e51b815280610722600482016106e5565b0390fd5b5f80fd5b9050519061073782610118565b565b905051906107468261019e565b565b919060c0838203126107ca576107c39061076260c0610210565b9361076f825f830161072a565b5f8601526107808260208301610739565b60208601526107928260408301610739565b60408601526107a4826060830161072a565b60608601526107b6826080830161072a565b608086015260a00161072a565b60a0830152565b610726565b9060c0828203126107e8576107e5915f01610748565b90565b61006c565b5190565b6107fb9051610192565b90565b61080890516100ba565b90565b61081490610192565b9052565b604090610841610848949695939661083760608401985f85019061080b565b60208301906100bd565b01906100bd565b565b60209181520190565b90825f9392825e0152565b61087d61088660209361088b93610874816107ed565b9384809361084a565b95869101610853565b6101c9565b0190565b916108b2926108a560408201935f83019061080b565b602081840391015261085e565b90565b5f90565b5f7f53797374656d20666f72776172646572206661696c6564000000000000000000910152565b6108ed6017602092610545565b6108f6816108b9565b0190565b61090f9060208101905f8183039101526108e0565b90565b1561091957565b610921610062565b62461bcd60e51b815280610937600482016108fa565b0390fd5b61094481610540565b0361094b57565b5f80fd5b9050519061095c8261093b565b565b9092919261097361096e82610225565b610210565b9381855260208501908284011161098f5761098d92610853565b565b6101c5565b9080601f830112156109b2578160206109af9351910161095e565b90565b6101c1565b9190916040818403126109f7576109d0835f830161094f565b92602082015167ffffffffffffffff81116109f2576109ef9201610994565b90565b610114565b61006c565b604090610a25610a2c9496959396610a1b60608401985f8501906100bd565b602083019061080b565b01906100bd565b565b60407f756e7375636365737366756c0000000000000000000000000000000000000000917f4661696c656420746f20696e6372656d656e74207469636b65742062616c616e5f8201527f63653a207469636b65745f62616c616e63655f6164642063616c6c207761732060208201520152565b610aae604c606092610545565b610ab781610a2e565b0190565b610ad09060208101905f818303910152610aa1565b90565b15610ada57565b610ae2610062565b62461bcd60e51b815280610af860048201610abb565b0390fd5b90565b610b13610b0e610b18926100ba565b610afc565b6100ba565b90565b90959492610b6694610b55610b5f92610b4b608096610b4160a088019c5f89019061080b565b602087019061080b565b60408501906100bd565b60608301906100bd565b01906100bd565b565b5f7f436f756c64206e6f742072656d6f7665206465706f7369740000000000000000910152565b610b9c6018602092610545565b610ba581610b68565b0190565b610bbe9060208101905f818303910152610b8f565b90565b15610bc857565b610bd0610062565b62461bcd60e51b815280610be660048201610ba9565b0390fd5b5f80610e72610e81610ea294610c6c8480610c23610c3285610c0a610062565b928391600460208401630ad83b9d60e11b8152016100ca565b602082018103825203826101e7565b610c3a610654565b9082602082019151925af1610c56610c5061067b565b916106fd565b6020610c61826107ed565b8183010191016107cf565b610d478580610c7d602085016107f1565b610ccb610c8b8387016107fe565b91610cbc610c9b606089016107fe565b610ca3610062565b948593600460208601630efe6a8b60e01b815201610818565b602082018103825203826101e7565b610d0d610cda604087016107f1565b610cfe610ce5610062565b9384926004602085016337d6e7b960e11b81520161088f565b602082018103825203826101e7565b610d156108b5565b9082602082019151925af1610d31610d2b61067b565b91610912565b6020610d3c826107ed565b8183010191016109b7565b508514610ea457610d5a604082016107f1565b5b610dd08680610d6c606086016107fe565b610daf8591610da0610d7f858a016107fe565b610d87610062565b94859360046020860163f9d70f6960e01b8152016109fc565b602082018103825203826101e7565b610db7610654565b9082602082019151925af1610dca61067b565b50610ad3565b610ddc606083016107fe565b90610de9602084016107f1565b90610e4e610df88986016107fe565b94610e1160a0610e0a608084016107fe565b92016107fe565b90610e3c7f7ee7a1de9c18ce695c95b8b19fbdf26cce3544e3ca9e08c9f487776783d7599f96610aff565b96610e45610062565b95869586610b1b565b0390a2610e59610062565b92839160046020840163029b6f6360e31b8152016100ca565b602082018103825203826101e7565b610e89610654565b9082602082019151925af1610e9c61067b565b50610bc1565b565b610eb0602082016107f1565b610d5b565b610ebe9061061a565b565b90610ef294939291610ee2610edd610ed75f610533565b15610540565b6105a7565b610eed60015f6105fa565b61141b565b610efc5f5f6105fa565b565b90565b610f15610f10610f1a92610efe565b610afc565b6100ba565b90565b60207f6400000000000000000000000000000000000000000000000000000000000000917f456d707479207769746864726177616c7320617265206e6f7420616c6c6f77655f8201520152565b610f776021604092610545565b610f8081610f1d565b0190565b610f999060208101905f818303910152610f6a565b90565b15610fa357565b610fab610062565b62461bcd60e51b815280610fc160048201610f84565b0390fd5b90565b610fd4610fd9916102ac565b610fc5565b9052565b905090565b611007610ffe92602092610ff5816107ed565b94858093610fdd565b93849101610853565b0190565b8061101c6016926110239594610fc8565b0190610fe2565b90565b60200190565b61103861103d91610514565b610aff565b90565b61104c61105191610514565b610083565b90565b61105e9054611040565b90565b634e487b7160e01b5f52601160045260245ffd5b61107e906100ba565b5f19811461108c5760010190565b611061565b9061109d5f19916105d0565b9181191691161790565b90565b906110bf6110ba6110c692610aff565b6110a7565b8254611091565b9055565b60407f617320756e7375636365737366756c0000000000000000000000000000000000917f4661696c656420746f2064656372656d656e74207469636b65742062616c616e5f8201527f63653a207469636b65745f62616c616e63655f72656d6f76652063616c6c207760208201520152565b61114a604f606092610545565b611153816110ca565b0190565b61116c9060208101905f81830391015261113d565b90565b1561117657565b61117e610062565b62461bcd60e51b81528061119460048201611157565b0390fd5b6111a1906102ac565b9052565b906111e99492936111d26111c76111dc9360808601908682035f88015261085e565b9560208501906100bd565b6040830190611198565b606081840391015261085e565b90565b600360ff60981b0190565b60407f75636365737366756c0000000000000000000000000000000000000000000000917f4661696c656420746f2070726f64756365206d6573736167653a20707573685f5f8201527f66615f7769746864726177616c5f746f5f6f7574626f782063616c6c20756e7360208201520152565b6112776049606092610545565b611280816111f7565b0190565b6112999060208101905f81830391015261126a565b90565b156112a357565b6112ab610062565b62461bcd60e51b8152806112c160048201611284565b0390fd5b905051906112d2826102bc565b565b919060408382031261130e57611307906112ee6040610210565b936112fb825f83016112c5565b5f8601526020016112c5565b6020830152565b610726565b9060408282031261132c57611329915f016112d4565b90565b61006c565b61133b90516102ac565b90565b91946113866113909298979561137c60a0966113726113979a61136860c08a019e5f8b019061080b565b602089019061080b565b6040870190611198565b6060850190611198565b60808301906100bd565b01906100bd565b565b5f7f50726f7879207769746864726177206661696c65640000000000000000000000910152565b6113cd6015602092610545565b6113d681611399565b0190565b6113ef9060208101905f8183039101526113c0565b90565b156113f957565b611401610062565b62461bcd60e51b815280611417600482016113da565b0390fd5b93929192835f61142a90610f01565b90611434906100ba565b1161143e90610f9c565b8281611448610062565b91829160208301916114599261100b565b60208201810382520361146c90826101e7565b611475816107ed565b9061147f90611026565b206114899061102c565b926114935f611054565b9261149d5f611054565b6114a690611075565b6114b0905f6110aa565b848787916114bc610062565b9283926020840163d93ad06360e01b8152600401926114da936109fc565b6020820181038252036114ed90826101e7565b6114f5610654565b6020820191515a925f8094938194f161150c61067b565b506115169061116f565b859192611521610062565b9384936020850163e9f58a7760e01b81526004019361153f946111a5565b60208201810382520361155290826101e7565b61155a6111ec565b6020820191515a925f8094938194f161157161067b565b9061157b9061129c565b611584816107ed565b6020820101906020019061159791611313565b8290338690825f016115a890611331565b926020016115b590611331565b94877fab68450c9e546f6062a861eebf8ec5bbd41b4425e26b20199c91227c7f9038ca956115e290610aff565b966115eb610062565b9586956115f8958761133e565b0390a233919091611607610062565b92839260208401635ae2fb3960e11b81526004019261162593610818565b60208201810382520361163890826101e7565b906020820191515a925f8094938194f161165061067b565b5061165a906113f2565b565b9061166994939291610ec0565b565b9061169f96959493929161168f61168a6116845f610533565b15610540565b6105a7565b61169a60015f6105fa565b6118a2565b6116a95f5f6105fa565b565b5190565b6116ce6116d76020936116dc936116c5816116ab565b93848093610545565b95869101610853565b6101c9565b0190565b979694611732611756979360c09661172561174e9760408e61171e6117136117409a60e08401908482035f86015261085e565b9660208301906100bd565b0190611198565b8b820360608d015261085e565b9089820360808b01526116af565b9087820360a089015261085e565b9401906100bd565b565b60407f6c20756e7375636365737366756c000000000000000000000000000000000000917f4661696c656420746f2070726f64756365206d6573736167653a20707573685f5f8201527f666173745f66615f7769746864726177616c5f746f5f6f7574626f782063616c60208201520152565b6117d8604e606092610545565b6117e181611758565b0190565b6117fa9060208101905f8183039101526117cb565b90565b1561180457565b61180c610062565b62461bcd60e51b815280611822600482016117e5565b0390fd5b95939196949290966101008701975f88016118409161080b565b6020870161184d9161080b565b6040860161185a91611198565b6060850161186791611198565b60808401611874916100bd565b60a08301611881916100bd565b60c0820161188e916100bd565b8082039060e0015261189f9161085e565b90565b95929493909194855f6118b490610f01565b906118be906100ba565b116118c890610f9c565b80826118d2610062565b91829160208301916118e39261100b565b6020820181038252036118f690826101e7565b6118ff816107ed565b9061190990611026565b206119139061102c565b9461191d5f611054565b936119275f611054565b61193090611075565b61193a905f6110aa565b86898991611946610062565b9283926020840163d93ad06360e01b815260040192611964936109fc565b60208201810382520361197790826101e7565b61197f610654565b6020820191515a925f8094938194f161199661067b565b506119a09061116f565b9087929390869086926119b1610062565b9687966020880163164faff760e31b8152600401966119cf976116e0565b6020820181038252036119e290826101e7565b6119ea6111ec565b6020820191515a925f8094938194f1611a0161067b565b90611a0b906117fd565b611a14816107ed565b60208201019060200190611a2791611313565b8391338791835f01611a3890611331565b93602001611a4590611331565b9588914291927f7e40c982e82bccb5e8bbd29f38bcfa3996f341ef9f51e2a9cffe086ec87a11c797611a7690610aff565b98611a7f610062565b978897611a8c9789611826565b0390a233919091611a9b610062565b92839260208401635ae2fb3960e11b815260040192611ab993610818565b602082018103825203611acc90826101e7565b906020820191515a925f8094938194f1611ae461067b565b50611aee906113f2565b565b90611aff96959493929161166b565b56fea2646970667358221220ab5df4c531a2dd079580da8afbdc84b2b400faf31da427b24cec0d47f19bc1f964736f6c634300081d0033";

pub(crate) const INTERNAL_FORWARDER_SOL_CONTRACT: &str = "0x60806040526004361015610010575b005b61001a5f35610029565b636fadcf720361000e57610197565b60e01c90565b60405190565b5f80fd5b5f80fd5b5f80fd5b60018060a01b031690565b61005590610041565b90565b6100618161004c565b0361006857565b5f80fd5b9050359061007982610058565b565b5f80fd5b5f80fd5b5f80fd5b909182601f830112156100c15781359167ffffffffffffffff83116100bc5760200192600183028401116100b757565b610083565b61007f565b61007b565b919091604081840312610107576100df835f830161006c565b92602082013567ffffffffffffffff8111610102576100fe9201610087565b9091565b61003d565b610039565b151590565b61011a9061010c565b9052565b5190565b60209181520190565b90825f9392825e0152565b601f801991011690565b61015f61016860209361016d936101568161011e565b93848093610122565b9586910161012b565b610136565b0190565b916101949261018760408201935f830190610111565b6020818403910152610140565b90565b346101c9576101b06101aa3660046100c6565b916103e5565b906101c56101bc61002f565b92839283610171565b0390f35b610035565b5f90565b606090565b600260ff60981b0190565b60209181520190565b60207f63616c6c65720000000000000000000000000000000000000000000000000000917f496e7465726e616c466f727761726465723a20756e617574686f72697a6564205f8201520152565b61024560266040926101e2565b61024e816101eb565b0190565b6102679060208101905f818303910152610238565b90565b1561027157565b61027961002f565b62461bcd60e51b81528061028f60048201610252565b0390fd5b906102c3949392916102be336102b86102b26102ad6101d7565b61004c565b9161004c565b1461026a565b6103b5565b9091565b905090565b90825f939282370152565b9091826102e7816102ee936102c7565b80936102cc565b0190565b90916102fd926102d7565b90565b634e487b7160e01b5f52604160045260245ffd5b9061031e90610136565b810190811067ffffffffffffffff82111761033857604052565b610300565b9061035061034961002f565b9283610314565b565b67ffffffffffffffff81116103705761036c602091610136565b0190565b610300565b9061038761038283610352565b61033d565b918252565b3d5f146103a75761039c3d610375565b903d5f602084013e5b565b6103af6101d2565b906103a5565b5f94919285949385925050926103d56103cc61002f565b938492836102f2565b03925af16103e161038c565b9091565b9061040192916103f36101ce565b6103fb6101d2565b90610293565b909156fea2646970667358221220d5097227fa62b2533a977713064491da57191217e74d82101e2ed068996af89b64736f6c634300081d0033";

pub(crate) const WITHDRAWAL_SOL_ADDR: Address = Address(FixedBytes::new([
    0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x01,
]));

pub(crate) const FA_WITHDRAWAL_SOL_ADDR: Address = Address(FixedBytes::new([
    0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x02,
]));

pub(crate) const WITHDRAWAL_SOL_CODE_HASH: FixedBytes<32> = FixedBytes::new([
    0xbf, 0xe8, 0xcd, 0x31, 0xa5, 0xca, 0xe4, 0x08, 0xbf, 0xb8, 0x31, 0x2a, 0x1c, 0x73,
    0xdf, 0x67, 0xfd, 0x24, 0xd1, 0x5e, 0xb3, 0x9e, 0x12, 0x23, 0xf2, 0x48, 0x0e, 0x92,
    0x00, 0xdd, 0x01, 0xe8,
]);

pub(crate) const FA_WITHDRAWAL_SOL_CODE_HASH: FixedBytes<32> = FixedBytes::new([
    0x14, 0x89, 0x0b, 0x80, 0xfc, 0xdf, 0x8f, 0x83, 0x1f, 0x62, 0x02, 0x0c, 0x19, 0xc2,
    0x31, 0x95, 0x97, 0x17, 0x34, 0x60, 0xd7, 0x36, 0x32, 0xcc, 0x14, 0x5f, 0x42, 0xc5,
    0x6f, 0xf6, 0x6f, 0xc3,
]);

pub(crate) const INTERNAL_FORWARDER_SOL_CODE_HASH: FixedBytes<32> = FixedBytes::new([
    0xa6, 0xe5, 0xcd, 0x80, 0xfc, 0x8a, 0x09, 0x47, 0xcf, 0x9f, 0x85, 0x2b, 0x21, 0x88,
    0x4c, 0x42, 0x5d, 0xeb, 0x36, 0xc3, 0x48, 0x0b, 0xe1, 0x62, 0x5c, 0xb9, 0xdf, 0x31,
    0xc5, 0xd7, 0xad, 0x0e,
]);

pub(crate) const SEND_OUTBOX_MESSAGE_PRECOMPILE_ADDRESS: Address =
    Address(FixedBytes::new([
        0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03,
    ]));

pub(crate) const TABLE_PRECOMPILE_ADDRESS: Address = Address(FixedBytes::new([
    0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x04,
]));

#[cfg(test)]
pub(crate) const PRECOMPILE_BURN_ADDRESS: Address = Address(FixedBytes::new([
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0xde, 0xad,
]));

pub(crate) const CUSTOMS: [Address; 4] = [
    WITHDRAWAL_SOL_ADDR,
    FA_WITHDRAWAL_SOL_ADDR,
    SEND_OUTBOX_MESSAGE_PRECOMPILE_ADDRESS,
    TABLE_PRECOMPILE_ADDRESS,
];

// Rationale regarding the cost:
// A few decoding/encoding functions.
pub(crate) const SEND_OUTBOX_MESSAGE_BASE_COST: u64 = 500;

// Rationale regarding the cost:
// Covers the cost of 2 r/w access on cold keys.
pub(crate) const TICKET_TABLE_BASE_COST: u64 = 5000;

#[cfg(test)]
mod test {
    use super::{
        FA_WITHDRAWAL_SOL_CODE_HASH, FA_WITHDRAWAL_SOL_CONTRACT,
        INTERNAL_FORWARDER_SOL_CODE_HASH, INTERNAL_FORWARDER_SOL_CONTRACT,
        WITHDRAWAL_SOL_CODE_HASH, WITHDRAWAL_SOL_CONTRACT,
    };

    use crate::helpers::storage::bytes_hash;
    use revm::{
        primitives::{hex::FromHex, Bytes, FixedBytes},
        state::Bytecode,
    };

    fn check_code_hash_validity(code: &str, code_hash_voucher: FixedBytes<32>) {
        let bytecode = Bytecode::new_legacy(Bytes::from_hex(code).unwrap());
        let code_hash = bytes_hash(bytecode.original_byte_slice());
        // Keep this until the script is updated
        println!(
            "{:?}",
            code_hash
                .iter()
                .map(|e| format!("0x{e:02x}"))
                .collect::<Vec<String>>()
                .join(", ")
        );
        assert_eq!(code_hash, code_hash_voucher)
    }

    #[test]
    fn check_withdrawal_sol_code_hash() {
        check_code_hash_validity(WITHDRAWAL_SOL_CONTRACT, WITHDRAWAL_SOL_CODE_HASH)
    }

    #[test]
    fn check_fa_withdrawal_sol_code_hash() {
        check_code_hash_validity(FA_WITHDRAWAL_SOL_CONTRACT, FA_WITHDRAWAL_SOL_CODE_HASH)
    }

    #[test]
    fn check_internal_forwarder_sol_code_hash() {
        check_code_hash_validity(
            INTERNAL_FORWARDER_SOL_CONTRACT,
            INTERNAL_FORWARDER_SOL_CODE_HASH,
        )
    }
}
