// SPDX-FileCopyrightText: 2025 Nomadic Labs <contact@nomadic-labs.com>
// SPDX-FileCopyrightText: 2025 Functori <contact@functori.com>
//
// SPDX-License-Identifier: MIT

use revm::primitives::{Address, FixedBytes};

pub(crate) const WITHDRAWAL_SOL_CONTRACT: &str = "0x60806040526004361015610013575b6102c5565b61001d5f3561003c565b806367a32cd7146100375763cda4fee20361000e5761029c565b61023d565b60e01c90565b60405190565b5f80fd5b5f80fd5b5f80fd5b5f80fd5b601f801991011690565b634e487b7160e01b5f52604160045260245ffd5b9061008090610058565b810190811067ffffffffffffffff82111761009a57604052565b610062565b906100b26100ab610042565b9283610076565b565b67ffffffffffffffff81116100d2576100ce602091610058565b0190565b610062565b90825f939282370152565b909291926100f76100f2826100b4565b61009f565b9381855260208501908284011161011357610111926100d7565b565b610054565b9080601f8301121561013657816020610133933591016100e2565b90565b610050565b67ffffffffffffffff811161015957610155602091610058565b0190565b610062565b9092919261017361016e8261013b565b61009f565b9381855260208501908284011161018f5761018d926100d7565b565b610054565b9080601f830112156101b2578160206101af9335910161015e565b90565b610050565b91606083830312610233575f83013567ffffffffffffffff811161022e57826101e1918501610118565b92602081013567ffffffffffffffff81116102295783610202918301610118565b92604082013567ffffffffffffffff8111610224576102219201610194565b90565b61004c565b61004c565b61004c565b610048565b5f0190565b61025161024b3660046101b7565b91610997565b610259610042565b8061026381610238565b0390f35b90602082820312610297575f82013567ffffffffffffffff81116102925761028f9201610118565b90565b61004c565b610048565b6102af6102aa366004610267565b610bb0565b6102b7610042565b806102c181610238565b0390f35b5f80fd5b5f1c90565b60ff1690565b6102e06102e5916102c9565b6102ce565b90565b6102f2905c6102d4565b90565b151590565b60209181520190565b5f7f5265656e7472616e6379206973206e6f7420616c6c6f77656400000000000000910152565b61033760196020926102fa565b61034081610303565b0190565b6103599060208101905f81830391015261032a565b90565b1561036357565b61036b610042565b62461bcd60e51b81528061038160048201610344565b0390fd5b5f1b90565b9061039660ff91610385565b9181191691161790565b6103a9906102f5565b90565b90565b906103c46103bf6103cb926103a0565b6103ac565b825c61038a565b905d565b906103ff92916103ef6103ea6103e45f6102e8565b156102f5565b61035c565b6103fa60015f6103af565b61081d565b6104095f5f6103af565b565b600560ff60981b0190565b60018060a01b031690565b90565b61043861043361043d92610416565b610421565b610416565b90565b61044990610424565b90565b61045590610440565b90565b61046190610424565b90565b61046d90610458565b90565b60e01b90565b90565b61048281610476565b0361048957565b5f80fd5b9050519061049a82610479565b565b906020828203126104b5576104b2915f0161048d565b90565b610048565b6104c2610042565b3d5f823e3d90fd5b5190565b90825f9392825e0152565b6104f8610501602093610506936104ef816104ca565b938480936102fa565b958691016104ce565b610058565b0190565b5190565b60209181520190565b61053661053f6020936105449361052d8161050a565b9384809361050e565b958691016104ce565b610058565b0190565b61055190610476565b9052565b9061059a6105ac9597969461058c60809561057e6105a59560a08801908882035f8a01526104d9565b9086820360208801526104d9565b908482036040860152610517565b966060830190610548565b0190610548565b565b600360ff60981b0190565b906105cb6105c68361013b565b61009f565b918252565b606090565b3d5f146105f0576105e53d6105b9565b903d5f602084013e5b565b6105f86105d0565b906105ee565b5f7f43616c6c20746f20746865206f7574626f782073656e646572206661696c6564910152565b610631602080926102fa565b61063a816105fe565b0190565b6106539060208101905f818303910152610625565b90565b1561065d57565b610665610042565b62461bcd60e51b81528061067b6004820161063e565b0390fd5b61dead90565b905090565b6106955f8092610685565b0190565b6106a29061068a565b90565b5f7f4661696c656420746f206275726e000000000000000000000000000000000000910152565b6106d9600e6020926102fa565b6106e2816106a5565b0190565b6106fb9060208101905f8183039101526106cc565b90565b1561070557565b61070d610042565b62461bcd60e51b815280610723600482016106e6565b0390fd5b60200190565b69ffffffffffffffffffff191690565b610747905161072d565b90565b1b90565b61076861076361075d8361050a565b92610727565b61073d565b9060168110610776575b5090565b6107929069ffffffffffffffffffff199060160360080261074a565b165f610772565b6107a29061072d565b9052565b6107af90610416565b90565b6107bb906107a6565b9052565b9695939461080661081b966107fc60a0966107f26108139760208e6107eb60c082019a5f830190610799565b0190610548565b60408c0190610548565b60608a0190610548565b8782036080890152610517565b9401906107b2565b565b349161085c61082b84610db6565b91602061084661084161083c61040b565b61044c565b610464565b635445a29190610854610042565b948592610470565b8252815f8161086d60048201610238565b03925af19182156109925761095f936108c95f936108ba6109259686958691610964575b509891938b908a916108a1610042565b968795600460208801631be3287960e31b815201610555565b60208201810382520382610076565b6108d16105ae565b9082602082019151925af16108ed6108e76105d5565b91610656565b6109205f806108fa61067f565b88610903610042565b908161090e81610699565b03925af161091a6105d5565b506106fe565b61074e565b919293429033917f62e8e01e31b83084b97c32b1b11ad5a2042382f5f65ee4106ad4a0d0f8b9942c96610956610042565b968796876107bf565b0390a1565b610985915060203d811161098b575b61097d8183610076565b81019061049c565b5f610891565b503d610973565b6104ba565b906109a292916103cf565b565b6109d2906109c26109bd6109b75f6102e8565b156102f5565b61035c565b6109cd60015f6103af565b610a42565b6109dc5f5f6103af565b565b929160206109fa610a029360408701908782035f8901526104d9565b940190610548565b565b610a39610a4094610a2f606094989795610a25608086019a5f870190610548565b60208501906107b2565b6040830190610799565b0190610548565b565b34610a7f610a4f82610db6565b6020610a69610a64610a5f61040b565b61044c565b610464565b635445a29190610a77610042565b948592610470565b8252815f81610a9060048201610238565b03925af1908115610bab57610adf5f939284938491610b7d575b5095610ad0610ab7610042565b938492600460208501631ef3b63960e21b8152016109de565b60208201810382520382610076565b610ae76105ae565b9082602082019151925af190610b04610afe6105d5565b92610656565b610b375f80610b1161067f565b84610b1a610042565b9081610b2581610699565b03925af1610b316105d5565b506106fe565b610b78610b44339361074e565b937f2d5ad793181f5b6bd727c0c216461e019ecfe466353fdde9ccf813f45b84fa8294610b6f610042565b94859485610a04565b0390a1565b610b9e915060203d8111610ba4575b610b968183610076565b81019061049c565b5f610aaa565b503d610b8c565b6104ba565b610bb9906109a4565b565b5f90565b90565b610bd6610bd1610bdb92610bbf565b610421565b610476565b90565b610bec64e8d4a51000610bc2565b90565b634e487b7160e01b5f52601260045260245ffd5b610c0f610c1591610476565b91610476565b908115610c20570490565b610bef565b610c31610c3791610476565b91610476565b908115610c42570690565b610bef565b90565b610c5e610c59610c6392610c47565b610421565b610476565b90565b5f7f416d6f756e74206973207a65726f000000000000000000000000000000000000910152565b610c9a600e6020926102fa565b610ca381610c66565b0190565b610cbc9060208101905f818303910152610c8d565b90565b15610cc657565b610cce610042565b62461bcd60e51b815280610ce460048201610ca7565b0390fd5b60407f657a290000000000000000000000000000000000000000000000000000000000917f526f756e64696e6720776f756c64206c6f7365207765692c20616d6f756e74205f8201527f6d757374206265206d756c7469706c65206f662031305e3132202831206d757460208201520152565b610d6860436060926102fa565b610d7181610ce8565b0190565b610d8a9060208101905f818303910152610d5b565b90565b15610d9457565b610d9c610042565b62461bcd60e51b815280610db260048201610d75565b0390fd5b610dbe610bbb565b50610e1b610dd482610dce610bde565b90610c03565b91610e03610dea82610de4610bde565b90610c25565b91610dfd610df75f610c4a565b91610476565b11610cbf565b610e15610e0f5f610c4a565b91610476565b14610d8d565b9056fea2646970667358221220ddd07254f9ba29683d1d5d6f2d36e9a61b6fccf2251d0211dc7a560264fb6b2f64736f6c634300081d0033";

pub(crate) const FA_BRIDGE_SOL_CONTRACT: &str = "0x60806040526004361015610013575b610609565b61001d5f3561006c565b806302b5ef7314610067578063379607f51461006257806380fc1fe31461005d57806382ab5275146100585763fff7ca5f0361000e576105d9565b610463565b610391565b61021f565b6101d8565b60e01c90565b60405190565b5f80fd5b5f80fd5b5f80fd5b601f801991011690565b634e487b7160e01b5f52604160045260245ffd5b906100ac90610084565b810190811067ffffffffffffffff8211176100c657604052565b61008e565b906100de6100d7610072565b92836100a2565b565b90565b6100ec816100e0565b036100f357565b5f80fd5b90503590610104826100e3565b565b60018060a01b031690565b61011a90610106565b90565b61012681610111565b0361012d57565b5f80fd5b9050359061013e8261011d565b565b919060a0838203126101b0576101a99061015a60a06100cb565b93610167825f83016100f7565b5f8601526101788260208301610131565b602086015261018a82604083016100f7565b604086015261019c82606083016100f7565b60608601526080016100f7565b6080830152565b610080565b9060a0828203126101ce576101cb915f01610140565b90565b610078565b5f0190565b6101eb6101e63660046101b5565b610aff565b6101f3610072565b806101fd816101d3565b0390f35b9060208282031261021a57610217915f016100f7565b90565b610078565b61023261022d366004610201565b61129d565b61023a610072565b80610244816101d3565b0390f35b5f80fd5b5f80fd5b67ffffffffffffffff811161026e5761026a602091610084565b0190565b61008e565b90825f939282370152565b9092919261029361028e82610250565b6100cb565b938185526020850190828401116102af576102ad92610273565b565b61024c565b9080601f830112156102d2578160206102cf9335910161027e565b90565b610248565b69ffffffffffffffffffff191690565b6102f0816102d7565b036102f757565b5f80fd5b90503590610308826102e7565b565b91909160a08184031261038c57610323835f8301610131565b92602082013567ffffffffffffffff811161038757816103449184016102b4565b9261035282604085016100f7565b9261036083606083016102fb565b92608082013567ffffffffffffffff81116103825761037f92016102b4565b90565b61007c565b61007c565b610078565b6103a861039f36600461030a565b93929092611a92565b6103b0610072565b806103ba816101d3565b0390f35b919060c08382031261044057610439906103d860c06100cb565b936103e5825f83016100f7565b5f8601526103f68260208301610131565b60208601526104088260408301610131565b604086015261041a82606083016100f7565b606086015261042c82608083016100f7565b608086015260a0016100f7565b60a0830152565b610080565b9060c08282031261045e5761045b915f016103be565b90565b610078565b610476610471366004610445565b611e0e565b61047e610072565b80610488816101d3565b0390f35b67ffffffffffffffff81116104aa576104a6602091610084565b0190565b61008e565b909291926104c46104bf8261048c565b6100cb565b938185526020850190828401116104e0576104de92610273565b565b61024c565b9080601f8301121561050357816020610500933591016104af565b90565b610248565b9060e0828203126105d45761051f815f8401610131565b92602083013567ffffffffffffffff81116105cf57826105409185016102b4565b9261054e83604083016100f7565b9261055c81606084016102fb565b92608083013567ffffffffffffffff81116105ca578261057d9185016102b4565b9260a081013567ffffffffffffffff81116105c5578361059e9183016104e5565b9260c082013567ffffffffffffffff81116105c0576105bd92016102b4565b90565b61007c565b61007c565b61007c565b61007c565b610078565b6105f36105e7366004610508565b959490949391936122fc565b6105fb610072565b80610605816101d3565b0390f35b5f80fd5b5f1c90565b60ff1690565b6106246106299161060d565b610612565b90565b610636905c610618565b90565b151590565b60209181520190565b5f7f5265656e7472616e6379206973206e6f7420616c6c6f77656400000000000000910152565b61067b601960209261063e565b61068481610647565b0190565b61069d9060208101905f81830391015261066e565b90565b156106a757565b6106af610072565b62461bcd60e51b8152806106c560048201610688565b0390fd5b5f1b90565b906106da60ff916106c9565b9181191691161790565b6106ed90610639565b90565b90565b9061070861070361070f926106e4565b6106f0565b825c6106ce565b905d565b6107419061073161072c6107265f61062c565b15610639565b6106a0565b61073c60015f6106f3565b6107f9565b61074b5f5f6106f3565b565b5f90565b60207f63616c6c65720000000000000000000000000000000000000000000000000000917f496e7465726e616c466f727761726465723a20756e617574686f72697a6564205f8201520152565b6107ab602660409261063e565b6107b481610751565b0190565b6107cd9060208101905f81830391015261079e565b90565b156107d757565b6107df610072565b62461bcd60e51b8152806107f5600482016107b8565b0390fd5b610825906108203361081a61081461080f61074d565b610111565b91610111565b146107d0565b6109f1565b565b61083190516100e0565b90565b61083e9051610111565b90565b61084a906100e0565b9052565b61085790610111565b9052565b60409061088461088b949695939661087a60608401985f850190610841565b602083019061084e565b0190610841565b565b600460ff60981b0190565b906108aa6108a583610250565b6100cb565b918252565b606090565b3d5f146108cf576108c43d610898565b903d5f602084013e5b565b6108d76108af565b906108cd565b60207f6365000000000000000000000000000000000000000000000000000000000000917f4661696c656420746f20696e6372656d656e74207469636b65742062616c616e5f8201520152565b610937602260409261063e565b610940816108dd565b0190565b6109599060208101905f81830391015261092a565b90565b1561096357565b61096b610072565b62461bcd60e51b81528061098160048201610944565b0390fd5b90565b61099c6109976109a1926100e0565b610985565b6100e0565b90565b909594926109ef946109de6109e8926109d46080966109ca60a088019c5f89019061084e565b602087019061084e565b6040850190610841565b6060830190610841565b0190610841565b565b610a715f80610a0260408501610827565b610a50610a1160208701610834565b91610a41610a20858901610827565b610a28610072565b94859360046020860163f9d70f6960e01b81520161085b565b602082018103825203826100a2565b610a5861088d565b9082602082019151925af1610a6b6108b4565b5061095c565b610a7d60408201610827565b610a8960208301610834565b610a9560208401610834565b90610afa610aa45f8601610827565b94610abd6080610ab660608401610827565b9201610827565b90610ae87f7ee7a1de9c18ce695c95b8b19fbdf26cce3544e3ca9e08c9f487776783d7599f96610988565b96610af1610072565b958695866109a4565b0390a2565b610b0890610713565b565b610b3890610b28610b23610b1d5f61062c565b15610639565b6106a0565b610b3360015f6106f3565b610fd2565b610b425f5f6106f3565b565b9190610b57905f60208501940190610841565b565b5f7f436f756c64206e6f742066696e64206465706f73697400000000000000000000910152565b610b8d601660209261063e565b610b9681610b59565b0190565b610baf9060208101905f818303910152610b80565b90565b15610bb957565b610bc1610072565b62461bcd60e51b815280610bd760048201610b9a565b0390fd5b90505190610be8826100e3565b565b90505190610bf78261011d565b565b919060c083820312610c7b57610c7490610c1360c06100cb565b93610c20825f8301610bdb565b5f860152610c318260208301610bea565b6020860152610c438260408301610bea565b6040860152610c558260608301610bdb565b6060860152610c678260808301610bdb565b608086015260a001610bdb565b60a0830152565b610080565b9060c082820312610c9957610c96915f01610bf9565b90565b610078565b5190565b604090610ccb610cd29496959396610cc160608401985f85019061084e565b6020830190610841565b0190610841565b565b60209181520190565b90825f9392825e0152565b610d07610d10602093610d1593610cfe81610c9e565b93848093610cd4565b95869101610cdd565b610084565b0190565b91610d3c92610d2f60408201935f83019061084e565b6020818403910152610ce8565b90565b5f7f53797374656d20666f72776172646572206661696c6564000000000000000000910152565b610d73601760209261063e565b610d7c81610d3f565b0190565b610d959060208101905f818303910152610d66565b90565b15610d9f57565b610da7610072565b62461bcd60e51b815280610dbd60048201610d80565b0390fd5b610dca81610639565b03610dd157565b5f80fd5b90505190610de282610dc1565b565b90929192610df9610df482610250565b6100cb565b93818552602085019082840111610e1557610e1392610cdd565b565b61024c565b9080601f83011215610e3857816020610e3593519101610de4565b90565b610248565b919091604081840312610e7d57610e56835f8301610dd5565b92602082015167ffffffffffffffff8111610e7857610e759201610e1a565b90565b61007c565b610078565b60407f756e7375636365737366756c0000000000000000000000000000000000000000917f4661696c656420746f20696e6372656d656e74207469636b65742062616c616e5f8201527f63653a207469636b65745f62616c616e63655f6164642063616c6c207761732060208201520152565b610f02604c60609261063e565b610f0b81610e82565b0190565b610f249060208101905f818303910152610ef5565b90565b15610f2e57565b610f36610072565b62461bcd60e51b815280610f4c60048201610f0f565b0390fd5b5f7f436f756c64206e6f742072656d6f7665206465706f7369740000000000000000910152565b610f84601860209261063e565b610f8d81610f50565b0190565b610fa69060208101905f818303910152610f77565b90565b15610fb057565b610fb8610072565b62461bcd60e51b815280610fce60048201610f91565b0390fd5b5f8061125a61126961128a94611054848061100b61101a85610ff2610072565b928391600460208401630ad83b9d60e11b815201610b44565b602082018103825203826100a2565b61102261088d565b9082602082019151925af161103e6110386108b4565b91610bb2565b602061104982610c9e565b818301019101610c80565b61112f858061106560208501610834565b6110b3611073838701610827565b916110a461108360608901610827565b61108b610072565b948593600460208601630efe6a8b60e01b815201610ca2565b602082018103825203826100a2565b6110f56110c260408701610834565b6110e66110cd610072565b9384926004602085016337d6e7b960e11b815201610d19565b602082018103825203826100a2565b6110fd61074d565b9082602082019151925af16111196111136108b4565b91610d98565b602061112482610c9e565b818301019101610e3d565b50851461128c5761114260408201610834565b5b6111b8868061115460608601610827565b6111978591611188611167858a01610827565b61116f610072565b94859360046020860163f9d70f6960e01b81520161085b565b602082018103825203826100a2565b61119f61088d565b9082602082019151925af16111b26108b4565b50610f27565b6111c460608301610827565b906111d160208401610834565b906112366111e0898601610827565b946111f960a06111f260808401610827565b9201610827565b906112247f7ee7a1de9c18ce695c95b8b19fbdf26cce3544e3ca9e08c9f487776783d7599f96610988565b9661122d610072565b958695866109a4565b0390a2611241610072565b92839160046020840163029b6f6360e31b815201610b44565b602082018103825203826100a2565b61127161088d565b9082602082019151925af16112846108b4565b50610fa9565b565b61129860208201610834565b611143565b6112a690610b0a565b565b906112da949392916112ca6112c56112bf5f61062c565b15610639565b6106a0565b6112d560015f6106f3565b611804565b6112e45f5f6106f3565b565b90565b6112fd6112f8611302926112e6565b610985565b6100e0565b90565b60207f6400000000000000000000000000000000000000000000000000000000000000917f456d707479207769746864726177616c7320617265206e6f7420616c6c6f77655f8201520152565b61135f602160409261063e565b61136881611305565b0190565b6113819060208101905f818303910152611352565b90565b1561138b57565b611393610072565b62461bcd60e51b8152806113a96004820161136c565b0390fd5b90565b6113bc6113c1916102d7565b6113ad565b9052565b905090565b6113ef6113e6926020926113dd81610c9e565b948580936113c5565b93849101610cdd565b0190565b8061140460169261140b95946113b0565b01906113ca565b90565b60200190565b6114206114259161060d565b610988565b90565b600560ff60981b0190565b61144761144261144c92610106565b610985565b610106565b90565b61145890611433565b90565b6114649061144f565b90565b61147090611433565b90565b61147c90611467565b90565b60e01b90565b9060208282031261149e5761149b915f01610bdb565b90565b610078565b6114ab610072565b3d5f823e3d90fd5b60407f617320756e7375636365737366756c0000000000000000000000000000000000917f4661696c656420746f2064656372656d656e74207469636b65742062616c616e5f8201527f63653a207469636b65745f62616c616e63655f72656d6f76652063616c6c207760208201520152565b611533604f60609261063e565b61153c816114b3565b0190565b6115559060208101905f818303910152611526565b90565b1561155f57565b611567610072565b62461bcd60e51b81528061157d60048201611540565b0390fd5b61158a906102d7565b9052565b906115d29492936115bb6115b06115c59360808601908682035f880152610ce8565b956020850190610841565b6040830190611581565b6060818403910152610ce8565b90565b600360ff60981b0190565b60407f75636365737366756c0000000000000000000000000000000000000000000000917f4661696c656420746f2070726f64756365206d6573736167653a20707573685f5f8201527f66615f7769746864726177616c5f746f5f6f7574626f782063616c6c20756e7360208201520152565b611660604960609261063e565b611669816115e0565b0190565b6116829060208101905f818303910152611653565b90565b1561168c57565b611694610072565b62461bcd60e51b8152806116aa6004820161166d565b0390fd5b905051906116bb826102e7565b565b91906040838203126116f7576116f0906116d760406100cb565b936116e4825f83016116ae565b5f8601526020016116ae565b6020830152565b610080565b9060408282031261171557611712915f016116bd565b90565b610078565b61172490516102d7565b90565b919461176f6117799298979561176560a09661175b6117809a61175160c08a019e5f8b019061084e565b602089019061084e565b6040870190611581565b6060850190611581565b6080830190610841565b0190610841565b565b5f7f50726f7879207769746864726177206661696c65640000000000000000000000910152565b6117b6601560209261063e565b6117bf81611782565b0190565b6117d89060208101905f8183039101526117a9565b90565b156117e257565b6117ea610072565b62461bcd60e51b815280611800600482016117c3565b0390fd5b909161189e936118268261182061181a5f6112e9565b916100e0565b11611384565b61186d81611855889161184661183a610072565b938492602084016113f3565b602082018103825203826100a2565b61186761186182610c9e565b9161140e565b20611414565b91602061188861188361187e611428565b61145b565b611473565b635445a29190611896610072565b98899261147f565b8252815f816118af600482016101d3565b03925af18015611a8d576119ac5f80611a4595611972611a5d9c611963849d9c61193f869e878f8f9c8e9161190f61191e9285968691611a5f575b509f91936118f6610072565b94859360046020860163d93ad06360e01b81520161085b565b602082018103825203826100a2565b61192661088d565b9082602082019151925af16119396108b4565b50611558565b91899461194a610072565b95869460046020870163e9f58a7760e01b81520161158e565b602082018103825203826100a2565b61197a6115d5565b9082602082019151925af16119966119906108b4565b91611685565b60206119a182610c9e565b8183010191016116fc565b90849033611a0c88926119cc60206119c58d890161171a565b970161171a565b908790916119fa7fab68450c9e546f6062a861eebf8ec5bbd41b4425e26b20199c91227c7f9038ca97610988565b97611a03610072565b96879687611727565b0390a2611a36339193611a1d610072565b948593600460208601635ae2fb3960e11b815201610ca2565b602082018103825203826100a2565b82602082019151925af1611a576108b4565b506117db565b565b611a80915060203d8111611a86575b611a7881836100a2565b810190611485565b5f6118ea565b503d611a6e565b6114a3565b90611a9f949392916112a8565b565b611acf90611abf611aba611ab45f61062c565b15610639565b6106a0565b611aca60015f6106f3565b611adb565b611ad95f5f6106f3565b565b611b0790611b0233611afc611af6611af161074d565b610111565b91610111565b146107d0565b611c8d565b565b611b12906100e0565b9052565b611b1f90610111565b9052565b9060a080611b8d93611b3b5f8201515f860190611b09565b611b4d60208201516020860190611b16565b611b5f60408201516040860190611b16565b611b7160608201516060860190611b09565b611b8360808201516080860190611b09565b0151910190611b09565b565b9160c0611bb0929493611ba960e08201965f830190611b23565b0190610841565b565b5f7f436f756c64206e6f74207175657565206465706f736974000000000000000000910152565b611be6601760209261063e565b611bef81611bb2565b0190565b611c089060208101905f818303910152611bd9565b90565b15611c1257565b611c1a610072565b62461bcd60e51b815280611c3060048201611bf3565b0390fd5b611c3d90611467565b90565b90959492611c8b94611c7a611c8492611c70608096611c6660a088019c5f890190610841565b602087019061084e565b6040850190610841565b6060830190610841565b0190610841565b565b611cc06020611caa611ca5611ca0611428565b61145b565b611473565b635445a29190611cb8610072565b93849261147f565b8252815f81611cd1600482016101d3565b03925af1908115611e09575f91611ddb575b50611d435f8084611d228591611d13611cfa610072565b938492600460208501630dddcea360e01b815201611b8f565b602082018103825203826100a2565b611d2a61088d565b9082602082019151925af1611d3d6108b4565b50611c0b565b611d4f60608301610827565b611d5b60408401610834565b91611d6860208501610834565b90611dd6611d775f8701610827565b95611d9060a0611d8960808401610827565b9201610827565b90611dc4611dbe7fb02d79c5657e344e23d91529b954c3087c60a974d598939583904a4f0b95961497610988565b97611c34565b97611dcd610072565b95869586611c40565b0390a3565b611dfc915060203d8111611e02575b611df481836100a2565b810190611485565b5f611ce3565b503d611dea565b6114a3565b611e1790611aa1565b565b90611e4d969594939291611e3d611e38611e325f61062c565b15610639565b6106a0565b611e4860015f6106f3565b612050565b611e575f5f6106f3565b565b5190565b611e7c611e85602093611e8a93611e7381611e59565b9384809361063e565b95869101610cdd565b610084565b0190565b979694611ee0611f04979360c096611ed3611efc9760408e611ecc611ec1611eee9a60e08401908482035f860152610ce8565b966020830190610841565b0190611581565b8b820360608d0152610ce8565b9089820360808b0152611e5d565b9087820360a0890152610ce8565b940190610841565b565b60407f6c20756e7375636365737366756c000000000000000000000000000000000000917f4661696c656420746f2070726f64756365206d6573736167653a20707573685f5f8201527f666173745f66615f7769746864726177616c5f746f5f6f7574626f782063616c60208201520152565b611f86604e60609261063e565b611f8f81611f06565b0190565b611fa89060208101905f818303910152611f79565b90565b15611fb257565b611fba610072565b62461bcd60e51b815280611fd060048201611f93565b0390fd5b95939196949290966101008701975f8801611fee9161084e565b60208701611ffb9161084e565b6040860161200891611581565b6060850161201591611581565b6080840161202291610841565b60a0830161202f91610841565b60c0820161203c91610841565b8082039060e0015261204d91610ce8565b90565b959294939091946120738661206d6120675f6112e9565b916100e0565b11611384565b6120ba816120a28491612093612087610072565b938492602084016113f3565b602082018103825203826100a2565b6120b46120ae82610c9e565b9161140e565b20611414565b946120ee60206120d86120d36120ce611428565b61145b565b611473565b635445a291906120e6610072565b93849261147f565b8252815f816120ff600482016101d3565b03925af19081156122f7575f916122c9575b50938689899161211f610072565b9283926020840163d93ad06360e01b81526004019261213d9361085b565b60208201810382520361215090826100a2565b61215861088d565b6020820191515a925f8094938194f161216f6108b4565b5061217990611558565b90879293908690869261218a610072565b9687966020880163164faff760e31b8152600401966121a897611e8e565b6020820181038252036121bb90826100a2565b6121c36115d5565b6020820191515a925f8094938194f16121da6108b4565b906121e490611fab565b6121ed81610c9e565b60208201019060200190612200916116fc565b8391338791835f016122119061171a565b9360200161221e9061171a565b9588914291927f7e40c982e82bccb5e8bbd29f38bcfa3996f341ef9f51e2a9cffe086ec87a11c79761224f90610988565b98612258610072565b9788976122659789611fd4565b0390a233919091612274610072565b92839260208401635ae2fb3960e11b81526004019261229293610ca2565b6020820181038252036122a590826100a2565b906020820191515a925f8094938194f16122bd6108b4565b506122c7906117db565b565b6122ea915060203d81116122f0575b6122e281836100a2565b810190611485565b5f612111565b503d6122d8565b6114a3565b9061230b969594939291611e19565b56fea26469706673582212208ee6f0c0356b0b53640a953f2e00e03897cad91021822bd171cf88f3b05ab77764736f6c634300081d0033";

pub(crate) const INTERNAL_FORWARDER_SOL_CONTRACT: &str = "0x60806040526004361015610010575b005b61001a5f35610029565b636fadcf720361000e57610197565b60e01c90565b60405190565b5f80fd5b5f80fd5b5f80fd5b60018060a01b031690565b61005590610041565b90565b6100618161004c565b0361006857565b5f80fd5b9050359061007982610058565b565b5f80fd5b5f80fd5b5f80fd5b909182601f830112156100c15781359167ffffffffffffffff83116100bc5760200192600183028401116100b757565b610083565b61007f565b61007b565b919091604081840312610107576100df835f830161006c565b92602082013567ffffffffffffffff8111610102576100fe9201610087565b9091565b61003d565b610039565b151590565b61011a9061010c565b9052565b5190565b60209181520190565b90825f9392825e0152565b601f801991011690565b61015f61016860209361016d936101568161011e565b93848093610122565b9586910161012b565b610136565b0190565b916101949261018760408201935f830190610111565b6020818403910152610140565b90565b346101c9576101b06101aa3660046100c6565b916103e5565b906101c56101bc61002f565b92839283610171565b0390f35b610035565b5f90565b606090565b600260ff60981b0190565b60209181520190565b60207f63616c6c65720000000000000000000000000000000000000000000000000000917f496e7465726e616c466f727761726465723a20756e617574686f72697a6564205f8201520152565b61024560266040926101e2565b61024e816101eb565b0190565b6102679060208101905f818303910152610238565b90565b1561027157565b61027961002f565b62461bcd60e51b81528061028f60048201610252565b0390fd5b906102c3949392916102be336102b86102b26102ad6101d7565b61004c565b9161004c565b1461026a565b6103b5565b9091565b905090565b90825f939282370152565b9091826102e7816102ee936102c7565b80936102cc565b0190565b90916102fd926102d7565b90565b634e487b7160e01b5f52604160045260245ffd5b9061031e90610136565b810190811067ffffffffffffffff82111761033857604052565b610300565b9061035061034961002f565b9283610314565b565b67ffffffffffffffff81116103705761036c602091610136565b0190565b610300565b9061038761038283610352565b61033d565b918252565b3d5f146103a75761039c3d610375565b903d5f602084013e5b565b6103af6101d2565b906103a5565b5f94919285949385925050926103d56103cc61002f565b938492836102f2565b03925af16103e161038c565b9091565b9061040192916103f36101ce565b6103fb6101d2565b90610293565b909156fea2646970667358221220da64ebb94fdb50a70d4dfe74a5b36e105052ee2de6a429d22b620a234a38cc0764736f6c634300081d0033";

pub(crate) const WITHDRAWAL_SOL_ADDR: Address = Address(FixedBytes::new([
    0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x01,
]));

pub(crate) const FA_BRIDGE_SOL_ADDR: Address = Address(FixedBytes::new([
    0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x02,
]));

pub(crate) const WITHDRAWAL_SOL_CODE_HASH: FixedBytes<32> = FixedBytes::new([
    0x49, 0xd9, 0x5e, 0xda, 0x8d, 0xa6, 0x90, 0x46, 0xbf, 0xa5, 0x75, 0x42, 0x0c, 0x70,
    0xf5, 0x2e, 0xd0, 0x1c, 0xf4, 0x58, 0x55, 0x8e, 0xe1, 0x4f, 0x0e, 0x13, 0xe6, 0x54,
    0x03, 0x01, 0x24, 0xa6,
]);

pub(crate) const FA_BRIDGE_SOL_CODE_HASH: FixedBytes<32> = FixedBytes::new([
    0xf8, 0xaf, 0x6d, 0x53, 0x89, 0x72, 0xe3, 0x53, 0xb9, 0x36, 0xa3, 0x78, 0x5b, 0x2a,
    0xc0, 0xc9, 0x65, 0x8c, 0x41, 0x87, 0xeb, 0x11, 0xb7, 0x29, 0x8b, 0x81, 0x7c, 0x9f,
    0x23, 0xb8, 0x8f, 0x4c,
]);

pub(crate) const INTERNAL_FORWARDER_SOL_CODE_HASH: FixedBytes<32> = FixedBytes::new([
    0x6e, 0x92, 0x1a, 0xee, 0x7d, 0xfa, 0x53, 0x7e, 0x36, 0x9b, 0x96, 0xa9, 0xad, 0x51,
    0xe6, 0x20, 0xe4, 0x14, 0x48, 0x88, 0xf5, 0xfe, 0x7f, 0x4c, 0xf9, 0xd4, 0xcf, 0xeb,
    0x5d, 0x71, 0x2f, 0xa3,
]);

pub(crate) const SEND_OUTBOX_MESSAGE_PRECOMPILE_ADDRESS: Address =
    Address(FixedBytes::new([
        0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03,
    ]));

pub(crate) const TABLE_PRECOMPILE_ADDRESS: Address = Address(FixedBytes::new([
    0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x04,
]));

pub(crate) const GLOBAL_COUNTER_PRECOMPILE_ADDRESS: Address = Address(FixedBytes::new([
    0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x05,
]));

pub(crate) const CHANGE_SEQUENCER_KEY_PRECOMPILE_ADDRESS: Address =
    Address(FixedBytes::new([
        0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x06,
    ]));

#[cfg(test)]
pub(crate) const PRECOMPILE_BURN_ADDRESS: Address = Address(FixedBytes::new([
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0xde, 0xad,
]));

pub(crate) const CUSTOMS: [Address; 6] = [
    WITHDRAWAL_SOL_ADDR,
    FA_BRIDGE_SOL_ADDR,
    SEND_OUTBOX_MESSAGE_PRECOMPILE_ADDRESS,
    TABLE_PRECOMPILE_ADDRESS,
    GLOBAL_COUNTER_PRECOMPILE_ADDRESS,
    CHANGE_SEQUENCER_KEY_PRECOMPILE_ADDRESS,
];

// Rationale regarding the cost:
// A few decoding/encoding functions.
pub(crate) const SEND_OUTBOX_MESSAGE_BASE_COST: u64 = 500;

// Rationale regarding the cost:
// Covers the cost of 2 r/w access on cold keys.
pub(crate) const TICKET_TABLE_BASE_COST: u64 = 5000;

// Rationale regarding the cost:
// Covers the cost of 2 r/w access on cold keys.
pub(crate) const GLOBAL_COUNTER_BASE_COST: u64 = 5000;

// Rationale regarding the cost:
// Covers the cost of 2 r/w access on cold keys.
pub(crate) const UPGRADE_SEQUENCER_PRECOMPILE_BASE_COST: u64 = 5000;

pub(crate) const SEQUENCER_UPGRADE_DELAY: u64 = 60 * 60 * 24; // 24 hours

#[cfg(test)]
mod test {
    use super::{
        FA_BRIDGE_SOL_CODE_HASH, FA_BRIDGE_SOL_CONTRACT,
        INTERNAL_FORWARDER_SOL_CODE_HASH, INTERNAL_FORWARDER_SOL_CONTRACT,
        WITHDRAWAL_SOL_CODE_HASH, WITHDRAWAL_SOL_CONTRACT,
    };

    use crate::helpers::storage::bytes_hash;
    use revm::{
        primitives::{hex::FromHex, Bytes, FixedBytes},
        state::Bytecode,
    };

    fn check_code_hash_validity(code: &str, code_hash_voucher: FixedBytes<32>) {
        let bytecode = Bytecode::new_legacy(Bytes::from_hex(code).unwrap());
        let code_hash = bytes_hash(bytecode.original_byte_slice());
        // Keep this until the script is updated
        println!(
            "{:?}",
            code_hash
                .iter()
                .map(|e| format!("0x{e:02x}"))
                .collect::<Vec<String>>()
                .join(", ")
        );
        assert_eq!(code_hash, code_hash_voucher)
    }

    #[test]
    fn check_withdrawal_sol_code_hash() {
        check_code_hash_validity(WITHDRAWAL_SOL_CONTRACT, WITHDRAWAL_SOL_CODE_HASH)
    }

    #[test]
    fn check_fa_withdrawal_sol_code_hash() {
        check_code_hash_validity(FA_BRIDGE_SOL_CONTRACT, FA_BRIDGE_SOL_CODE_HASH)
    }

    #[test]
    fn check_internal_forwarder_sol_code_hash() {
        check_code_hash_validity(
            INTERNAL_FORWARDER_SOL_CONTRACT,
            INTERNAL_FORWARDER_SOL_CODE_HASH,
        )
    }
}
