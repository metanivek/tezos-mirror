// SPDX-FileCopyrightText: 2025 Nomadic Labs <contact@nomadic-labs.com>
// SPDX-FileCopyrightText: 2025 Functori <contact@functori.com>
//
// SPDX-License-Identifier: MIT

use revm::primitives::{Address, FixedBytes};

pub(crate) const WITHDRAWAL_SOL_CONTRACT: &str = "0x60806040526004361015610013575b6102c5565b61001d5f3561003c565b806367a32cd7146100375763cda4fee20361000e5761029c565b61023d565b60e01c90565b60405190565b5f80fd5b5f80fd5b5f80fd5b5f80fd5b601f801991011690565b634e487b7160e01b5f52604160045260245ffd5b9061008090610058565b810190811067ffffffffffffffff82111761009a57604052565b610062565b906100b26100ab610042565b9283610076565b565b67ffffffffffffffff81116100d2576100ce602091610058565b0190565b610062565b90825f939282370152565b909291926100f76100f2826100b4565b61009f565b9381855260208501908284011161011357610111926100d7565b565b610054565b9080601f8301121561013657816020610133933591016100e2565b90565b610050565b67ffffffffffffffff811161015957610155602091610058565b0190565b610062565b9092919261017361016e8261013b565b61009f565b9381855260208501908284011161018f5761018d926100d7565b565b610054565b9080601f830112156101b2578160206101af9335910161015e565b90565b610050565b91606083830312610233575f83013567ffffffffffffffff811161022e57826101e1918501610118565b92602081013567ffffffffffffffff81116102295783610202918301610118565b92604082013567ffffffffffffffff8111610224576102219201610194565b90565b61004c565b61004c565b61004c565b610048565b5f0190565b61025161024b3660046101b7565b91610997565b610259610042565b8061026381610238565b0390f35b90602082820312610297575f82013567ffffffffffffffff81116102925761028f9201610118565b90565b61004c565b610048565b6102af6102aa366004610267565b610bb0565b6102b7610042565b806102c181610238565b0390f35b5f80fd5b5f1c90565b60ff1690565b6102e06102e5916102c9565b6102ce565b90565b6102f2905c6102d4565b90565b151590565b60209181520190565b5f7f5265656e7472616e6379206973206e6f7420616c6c6f77656400000000000000910152565b61033760196020926102fa565b61034081610303565b0190565b6103599060208101905f81830391015261032a565b90565b1561036357565b61036b610042565b62461bcd60e51b81528061038160048201610344565b0390fd5b5f1b90565b9061039660ff91610385565b9181191691161790565b6103a9906102f5565b90565b90565b906103c46103bf6103cb926103a0565b6103ac565b825c61038a565b905d565b906103ff92916103ef6103ea6103e45f6102e8565b156102f5565b61035c565b6103fa60015f6103af565b61081d565b6104095f5f6103af565b565b600560ff60981b0190565b60018060a01b031690565b90565b61043861043361043d92610416565b610421565b610416565b90565b61044990610424565b90565b61045590610440565b90565b61046190610424565b90565b61046d90610458565b90565b60e01b90565b90565b61048281610476565b0361048957565b5f80fd5b9050519061049a82610479565b565b906020828203126104b5576104b2915f0161048d565b90565b610048565b6104c2610042565b3d5f823e3d90fd5b5190565b90825f9392825e0152565b6104f8610501602093610506936104ef816104ca565b938480936102fa565b958691016104ce565b610058565b0190565b5190565b60209181520190565b61053661053f6020936105449361052d8161050a565b9384809361050e565b958691016104ce565b610058565b0190565b61055190610476565b9052565b9061059a6105ac9597969461058c60809561057e6105a59560a08801908882035f8a01526104d9565b9086820360208801526104d9565b908482036040860152610517565b966060830190610548565b0190610548565b565b600360ff60981b0190565b906105cb6105c68361013b565b61009f565b918252565b606090565b3d5f146105f0576105e53d6105b9565b903d5f602084013e5b565b6105f86105d0565b906105ee565b5f7f43616c6c20746f20746865206f7574626f782073656e646572206661696c6564910152565b610631602080926102fa565b61063a816105fe565b0190565b6106539060208101905f818303910152610625565b90565b1561065d57565b610665610042565b62461bcd60e51b81528061067b6004820161063e565b0390fd5b61dead90565b905090565b6106955f8092610685565b0190565b6106a29061068a565b90565b5f7f4661696c656420746f206275726e000000000000000000000000000000000000910152565b6106d9600e6020926102fa565b6106e2816106a5565b0190565b6106fb9060208101905f8183039101526106cc565b90565b1561070557565b61070d610042565b62461bcd60e51b815280610723600482016106e6565b0390fd5b60200190565b69ffffffffffffffffffff191690565b610747905161072d565b90565b1b90565b61076861076361075d8361050a565b92610727565b61073d565b9060168110610776575b5090565b6107929069ffffffffffffffffffff199060160360080261074a565b165f610772565b6107a29061072d565b9052565b6107af90610416565b90565b6107bb906107a6565b9052565b9695939461080661081b966107fc60a0966107f26108139760208e6107eb60c082019a5f830190610799565b0190610548565b60408c0190610548565b60608a0190610548565b8782036080890152610517565b9401906107b2565b565b349161085c61082b84610db6565b91602061084661084161083c61040b565b61044c565b610464565b635445a29190610854610042565b948592610470565b8252815f8161086d60048201610238565b03925af19182156109925761095f936108c95f936108ba6109259686958691610964575b509891938b908a916108a1610042565b968795600460208801631be3287960e31b815201610555565b60208201810382520382610076565b6108d16105ae565b9082602082019151925af16108ed6108e76105d5565b91610656565b6109205f806108fa61067f565b88610903610042565b908161090e81610699565b03925af161091a6105d5565b506106fe565b61074e565b919293429033917f62e8e01e31b83084b97c32b1b11ad5a2042382f5f65ee4106ad4a0d0f8b9942c96610956610042565b968796876107bf565b0390a1565b610985915060203d811161098b575b61097d8183610076565b81019061049c565b5f610891565b503d610973565b6104ba565b906109a292916103cf565b565b6109d2906109c26109bd6109b75f6102e8565b156102f5565b61035c565b6109cd60015f6103af565b610a42565b6109dc5f5f6103af565b565b929160206109fa610a029360408701908782035f8901526104d9565b940190610548565b565b610a39610a4094610a2f606094989795610a25608086019a5f870190610548565b60208501906107b2565b6040830190610799565b0190610548565b565b34610a7f610a4f82610db6565b6020610a69610a64610a5f61040b565b61044c565b610464565b635445a29190610a77610042565b948592610470565b8252815f81610a9060048201610238565b03925af1908115610bab57610adf5f939284938491610b7d575b5095610ad0610ab7610042565b938492600460208501631ef3b63960e21b8152016109de565b60208201810382520382610076565b610ae76105ae565b9082602082019151925af190610b04610afe6105d5565b92610656565b610b375f80610b1161067f565b84610b1a610042565b9081610b2581610699565b03925af1610b316105d5565b506106fe565b610b78610b44339361074e565b937f2d5ad793181f5b6bd727c0c216461e019ecfe466353fdde9ccf813f45b84fa8294610b6f610042565b94859485610a04565b0390a1565b610b9e915060203d8111610ba4575b610b968183610076565b81019061049c565b5f610aaa565b503d610b8c565b6104ba565b610bb9906109a4565b565b5f90565b90565b610bd6610bd1610bdb92610bbf565b610421565b610476565b90565b610bec64e8d4a51000610bc2565b90565b634e487b7160e01b5f52601260045260245ffd5b610c0f610c1591610476565b91610476565b908115610c20570490565b610bef565b610c31610c3791610476565b91610476565b908115610c42570690565b610bef565b90565b610c5e610c59610c6392610c47565b610421565b610476565b90565b5f7f416d6f756e74206973207a65726f000000000000000000000000000000000000910152565b610c9a600e6020926102fa565b610ca381610c66565b0190565b610cbc9060208101905f818303910152610c8d565b90565b15610cc657565b610cce610042565b62461bcd60e51b815280610ce460048201610ca7565b0390fd5b60407f657a290000000000000000000000000000000000000000000000000000000000917f526f756e64696e6720776f756c64206c6f7365207765692c20616d6f756e74205f8201527f6d757374206265206d756c7469706c65206f662031305e3132202831206d757460208201520152565b610d6860436060926102fa565b610d7181610ce8565b0190565b610d8a9060208101905f818303910152610d5b565b90565b15610d9457565b610d9c610042565b62461bcd60e51b815280610db260048201610d75565b0390fd5b610dbe610bbb565b50610e1b610dd482610dce610bde565b90610c03565b91610e03610dea82610de4610bde565b90610c25565b91610dfd610df75f610c4a565b91610476565b11610cbf565b610e15610e0f5f610c4a565b91610476565b14610d8d565b9056fea264697066735822122010778c2e422b73ddecf48d0c5481305d2c3de29950ff7fbcdda5daaf05a8463d64736f6c634300081d0033";

pub(crate) const FA_BRIDGE_SOL_CONTRACT: &str = "0x60806040526004361015610013575b610609565b61001d5f3561006c565b806302b5ef7314610067578063379607f51461006257806380fc1fe31461005d57806382ab5275146100585763fff7ca5f0361000e576105d9565b610463565b610391565b61021f565b6101d8565b60e01c90565b60405190565b5f80fd5b5f80fd5b5f80fd5b601f801991011690565b634e487b7160e01b5f52604160045260245ffd5b906100ac90610084565b810190811067ffffffffffffffff8211176100c657604052565b61008e565b906100de6100d7610072565b92836100a2565b565b90565b6100ec816100e0565b036100f357565b5f80fd5b90503590610104826100e3565b565b60018060a01b031690565b61011a90610106565b90565b61012681610111565b0361012d57565b5f80fd5b9050359061013e8261011d565b565b919060a0838203126101b0576101a99061015a60a06100cb565b93610167825f83016100f7565b5f8601526101788260208301610131565b602086015261018a82604083016100f7565b604086015261019c82606083016100f7565b60608601526080016100f7565b6080830152565b610080565b9060a0828203126101ce576101cb915f01610140565b90565b610078565b5f0190565b6101eb6101e63660046101b5565b610b01565b6101f3610072565b806101fd816101d3565b0390f35b9060208282031261021a57610217915f016100f7565b90565b610078565b61023261022d366004610201565b6112a3565b61023a610072565b80610244816101d3565b0390f35b5f80fd5b5f80fd5b67ffffffffffffffff811161026e5761026a602091610084565b0190565b61008e565b90825f939282370152565b9092919261029361028e82610250565b6100cb565b938185526020850190828401116102af576102ad92610273565b565b61024c565b9080601f830112156102d2578160206102cf9335910161027e565b90565b610248565b69ffffffffffffffffffff191690565b6102f0816102d7565b036102f757565b5f80fd5b90503590610308826102e7565b565b91909160a08184031261038c57610323835f8301610131565b92602082013567ffffffffffffffff811161038757816103449184016102b4565b9261035282604085016100f7565b9261036083606083016102fb565b92608082013567ffffffffffffffff81116103825761037f92016102b4565b90565b61007c565b61007c565b610078565b6103a861039f36600461030a565b93929092611aff565b6103b0610072565b806103ba816101d3565b0390f35b919060c08382031261044057610439906103d860c06100cb565b936103e5825f83016100f7565b5f8601526103f68260208301610131565b60208601526104088260408301610131565b604086015261041a82606083016100f7565b606086015261042c82608083016100f7565b608086015260a0016100f7565b60a0830152565b610080565b9060c08282031261045e5761045b915f016103be565b90565b610078565b610476610471366004610445565b611e7b565b61047e610072565b80610488816101d3565b0390f35b67ffffffffffffffff81116104aa576104a6602091610084565b0190565b61008e565b909291926104c46104bf8261048c565b6100cb565b938185526020850190828401116104e0576104de92610273565b565b61024c565b9080601f8301121561050357816020610500933591016104af565b90565b610248565b9060e0828203126105d45761051f815f8401610131565b92602083013567ffffffffffffffff81116105cf57826105409185016102b4565b9261054e83604083016100f7565b9261055c81606084016102fb565b92608083013567ffffffffffffffff81116105ca578261057d9185016102b4565b9260a081013567ffffffffffffffff81116105c5578361059e9183016104e5565b9260c082013567ffffffffffffffff81116105c0576105bd92016102b4565b90565b61007c565b61007c565b61007c565b61007c565b610078565b6105f36105e7366004610508565b959490949391936123cf565b6105fb610072565b80610605816101d3565b0390f35b5f80fd5b61feed90565b60209181520190565b60207f63616c6c65720000000000000000000000000000000000000000000000000000917f496e7465726e616c466f727761726465723a20756e617574686f72697a6564205f8201520152565b6106766026604092610613565b61067f8161061c565b0190565b6106989060208101905f818303910152610669565b90565b156106a257565b6106aa610072565b62461bcd60e51b8152806106c060048201610683565b0390fd5b6106f0906106eb336106e56106df6106da61060d565b610111565b91610111565b1461069b565b6107ef565b565b5f1c90565b60ff1690565b61070961070e916106f2565b6106f7565b90565b61071b905c6106fd565b90565b151590565b5f7f5265656e7472616e6379206973206e6f7420616c6c6f77656400000000000000910152565b6107576019602092610613565b61076081610723565b0190565b6107799060208101905f81830391015261074a565b90565b1561078357565b61078b610072565b62461bcd60e51b8152806107a160048201610764565b0390fd5b5f1b90565b906107b660ff916107a5565b9181191691161790565b6107c99061071e565b90565b90565b906107e46107df6107eb926107c0565b6107cc565b825c6107aa565b905d565b61081d9061080d6108086108025f610711565b1561071e565b61077c565b61081860015f6107cf565b6109f3565b6108275f5f6107cf565b565b61083390516100e0565b90565b6108409051610111565b90565b61084c906100e0565b9052565b61085990610111565b9052565b60409061088661088d949695939661087c60608401985f850190610843565b6020830190610850565b0190610843565b565b600460ff60981b0190565b906108ac6108a783610250565b6100cb565b918252565b606090565b3d5f146108d1576108c63d61089a565b903d5f602084013e5b565b6108d96108b1565b906108cf565b60207f6365000000000000000000000000000000000000000000000000000000000000917f4661696c656420746f20696e6372656d656e74207469636b65742062616c616e5f8201520152565b6109396022604092610613565b610942816108df565b0190565b61095b9060208101905f81830391015261092c565b90565b1561096557565b61096d610072565b62461bcd60e51b81528061098360048201610946565b0390fd5b90565b61099e6109996109a3926100e0565b610987565b6100e0565b90565b909594926109f1946109e06109ea926109d66080966109cc60a088019c5f890190610850565b6020870190610850565b6040850190610843565b6060830190610843565b0190610843565b565b610a735f80610a0460408501610829565b610a52610a1360208701610836565b91610a43610a22858901610829565b610a2a610072565b94859360046020860163f9d70f6960e01b81520161085d565b602082018103825203826100a2565b610a5a61088f565b9082602082019151925af1610a6d6108b6565b5061095e565b610a7f60408201610829565b610a8b60208301610836565b610a9760208401610836565b90610afc610aa65f8601610829565b94610abf6080610ab860608401610829565b9201610829565b90610aea7f7ee7a1de9c18ce695c95b8b19fbdf26cce3544e3ca9e08c9f487776783d7599f9661098a565b96610af3610072565b958695866109a6565b0390a2565b610b0a906106c4565b565b610b3a90610b2a610b25610b1f5f610711565b1561071e565b61077c565b610b3560015f6107cf565b610fd8565b610b445f5f6107cf565b565b9190610b59905f60208501940190610843565b565b5f7f436f756c64206e6f742066696e64206465706f73697400000000000000000000910152565b610b8f6016602092610613565b610b9881610b5b565b0190565b610bb19060208101905f818303910152610b82565b90565b15610bbb57565b610bc3610072565b62461bcd60e51b815280610bd960048201610b9c565b0390fd5b90505190610bea826100e3565b565b90505190610bf98261011d565b565b919060c083820312610c7d57610c7690610c1560c06100cb565b93610c22825f8301610bdd565b5f860152610c338260208301610bec565b6020860152610c458260408301610bec565b6040860152610c578260608301610bdd565b6060860152610c698260808301610bdd565b608086015260a001610bdd565b60a0830152565b610080565b9060c082820312610c9b57610c98915f01610bfb565b90565b610078565b5190565b604090610ccd610cd49496959396610cc360608401985f850190610850565b6020830190610843565b0190610843565b565b60209181520190565b90825f9392825e0152565b610d09610d12602093610d1793610d0081610ca0565b93848093610cd6565b95869101610cdf565b610084565b0190565b91610d3e92610d3160408201935f830190610850565b6020818403910152610cea565b90565b5f90565b5f7f53797374656d20666f72776172646572206661696c6564000000000000000000910152565b610d796017602092610613565b610d8281610d45565b0190565b610d9b9060208101905f818303910152610d6c565b90565b15610da557565b610dad610072565b62461bcd60e51b815280610dc360048201610d86565b0390fd5b610dd08161071e565b03610dd757565b5f80fd5b90505190610de882610dc7565b565b90929192610dff610dfa82610250565b6100cb565b93818552602085019082840111610e1b57610e1992610cdf565b565b61024c565b9080601f83011215610e3e57816020610e3b93519101610dea565b90565b610248565b919091604081840312610e8357610e5c835f8301610ddb565b92602082015167ffffffffffffffff8111610e7e57610e7b9201610e20565b90565b61007c565b610078565b60407f756e7375636365737366756c0000000000000000000000000000000000000000917f4661696c656420746f20696e6372656d656e74207469636b65742062616c616e5f8201527f63653a207469636b65745f62616c616e63655f6164642063616c6c207761732060208201520152565b610f08604c606092610613565b610f1181610e88565b0190565b610f2a9060208101905f818303910152610efb565b90565b15610f3457565b610f3c610072565b62461bcd60e51b815280610f5260048201610f15565b0390fd5b5f7f436f756c64206e6f742072656d6f7665206465706f7369740000000000000000910152565b610f8a6018602092610613565b610f9381610f56565b0190565b610fac9060208101905f818303910152610f7d565b90565b15610fb657565b610fbe610072565b62461bcd60e51b815280610fd460048201610f97565b0390fd5b5f8061126061126f6112909461105a848061101161102085610ff8610072565b928391600460208401630ad83b9d60e11b815201610b46565b602082018103825203826100a2565b61102861088f565b9082602082019151925af161104461103e6108b6565b91610bb4565b602061104f82610ca0565b818301019101610c82565b611135858061106b60208501610836565b6110b9611079838701610829565b916110aa61108960608901610829565b611091610072565b948593600460208601630efe6a8b60e01b815201610ca4565b602082018103825203826100a2565b6110fb6110c860408701610836565b6110ec6110d3610072565b9384926004602085016337d6e7b960e11b815201610d1b565b602082018103825203826100a2565b611103610d41565b9082602082019151925af161111f6111196108b6565b91610d9e565b602061112a82610ca0565b818301019101610e43565b5085146112925761114860408201610836565b5b6111be868061115a60608601610829565b61119d859161118e61116d858a01610829565b611175610072565b94859360046020860163f9d70f6960e01b81520161085d565b602082018103825203826100a2565b6111a561088f565b9082602082019151925af16111b86108b6565b50610f2d565b6111ca60608301610829565b906111d760208401610836565b9061123c6111e6898601610829565b946111ff60a06111f860808401610829565b9201610829565b9061122a7f7ee7a1de9c18ce695c95b8b19fbdf26cce3544e3ca9e08c9f487776783d7599f9661098a565b96611233610072565b958695866109a6565b0390a2611247610072565b92839160046020840163029b6f6360e31b815201610b46565b602082018103825203826100a2565b61127761088f565b9082602082019151925af161128a6108b6565b50610faf565b565b61129e60208201610836565b611149565b6112ac90610b0c565b565b906112e0949392916112d06112cb6112c55f610711565b1561071e565b61077c565b6112db60015f6107cf565b61180a565b6112ea5f5f6107cf565b565b90565b6113036112fe611308926112ec565b610987565b6100e0565b90565b60207f6400000000000000000000000000000000000000000000000000000000000000917f456d707479207769746864726177616c7320617265206e6f7420616c6c6f77655f8201520152565b6113656021604092610613565b61136e8161130b565b0190565b6113879060208101905f818303910152611358565b90565b1561139157565b611399610072565b62461bcd60e51b8152806113af60048201611372565b0390fd5b90565b6113c26113c7916102d7565b6113b3565b9052565b905090565b6113f56113ec926020926113e381610ca0565b948580936113cb565b93849101610cdf565b0190565b8061140a60169261141195946113b6565b01906113d0565b90565b60200190565b61142661142b916106f2565b61098a565b90565b600560ff60981b0190565b61144d61144861145292610106565b610987565b610106565b90565b61145e90611439565b90565b61146a90611455565b90565b61147690611439565b90565b6114829061146d565b90565b60e01b90565b906020828203126114a4576114a1915f01610bdd565b90565b610078565b6114b1610072565b3d5f823e3d90fd5b60407f617320756e7375636365737366756c0000000000000000000000000000000000917f4661696c656420746f2064656372656d656e74207469636b65742062616c616e5f8201527f63653a207469636b65745f62616c616e63655f72656d6f76652063616c6c207760208201520152565b611539604f606092610613565b611542816114b9565b0190565b61155b9060208101905f81830391015261152c565b90565b1561156557565b61156d610072565b62461bcd60e51b81528061158360048201611546565b0390fd5b611590906102d7565b9052565b906115d89492936115c16115b66115cb9360808601908682035f880152610cea565b956020850190610843565b6040830190611587565b6060818403910152610cea565b90565b600360ff60981b0190565b60407f75636365737366756c0000000000000000000000000000000000000000000000917f4661696c656420746f2070726f64756365206d6573736167653a20707573685f5f8201527f66615f7769746864726177616c5f746f5f6f7574626f782063616c6c20756e7360208201520152565b6116666049606092610613565b61166f816115e6565b0190565b6116889060208101905f818303910152611659565b90565b1561169257565b61169a610072565b62461bcd60e51b8152806116b060048201611673565b0390fd5b905051906116c1826102e7565b565b91906040838203126116fd576116f6906116dd60406100cb565b936116ea825f83016116b4565b5f8601526020016116b4565b6020830152565b610080565b9060408282031261171b57611718915f016116c3565b90565b610078565b61172a90516102d7565b90565b919461177561177f9298979561176b60a0966117616117869a61175760c08a019e5f8b0190610850565b6020890190610850565b6040870190611587565b6060850190611587565b6080830190610843565b0190610843565b565b5f7f50726f7879207769746864726177206661696c65640000000000000000000000910152565b6117bc6015602092610613565b6117c581611788565b0190565b6117de9060208101905f8183039101526117af565b90565b156117e857565b6117f0610072565b62461bcd60e51b815280611806600482016117c9565b0390fd5b6118a5939194929461182e866118286118225f6112ef565b916100e0565b1161138a565b6118758361185d869161184e611842610072565b938492602084016113f9565b602082018103825203826100a2565b61186f61186982610ca0565b91611414565b2061141a565b602061188f61188a61188561142e565b611461565b611479565b635445a2919061189d610072565b988992611485565b8252815f816118b6600482016101d3565b03925af1938415611afa5787826119bd5f80611a5695611983829c611aca9f611ac49f9b611950869f8f611a8a9f9461192f8a93926119208594611974998691611acc575b509f9193611907610072565b94859360046020860163d93ad06360e01b81520161085d565b602082018103825203826100a2565b61193761088f565b9082602082019151925af161194a6108b6565b5061155e565b91899461195b610072565b95869460046020870163e9f58a7760e01b815201611594565b602082018103825203826100a2565b61198b6115db565b9082602082019151925af16119a76119a16108b6565b9161168b565b60206119b282610ca0565b818301019101611702565b90849033611a1d89926119dd60206119d68e8901611720565b9701611720565b90879091611a0b7fab68450c9e546f6062a861eebf8ec5bbd41b4425e26b20199c91227c7f9038ca9761098a565b97611a14610072565b9687968761172d565b0390a2611a47339193611a2e610072565b948593600460208601635ae2fb3960e11b815201610ca4565b602082018103825203826100a2565b91611a7b611a62610072565b9384926004602085016337d6e7b960e11b815201610d1b565b602082018103825203826100a2565b611a92610d41565b9082602082019151925af1611aae611aa86108b6565b91610d9e565b6020611ab982610ca0565b818301019101610e43565b506117e1565b565b611aed915060203d8111611af3575b611ae581836100a2565b81019061148b565b5f6118fb565b503d611adb565b6114a9565b90611b0c949392916112ae565b565b611b3a90611b3533611b2f611b29611b2461060d565b610111565b91610111565b1461069b565b611b3c565b565b611b6a90611b5a611b55611b4f5f610711565b1561071e565b61077c565b611b6560015f6107cf565b611cfa565b611b745f5f6107cf565b565b611b7f906100e0565b9052565b611b8c90610111565b9052565b9060a080611bfa93611ba85f8201515f860190611b76565b611bba60208201516020860190611b83565b611bcc60408201516040860190611b83565b611bde60608201516060860190611b76565b611bf060808201516080860190611b76565b0151910190611b76565b565b9160c0611c1d929493611c1660e08201965f830190611b90565b0190610843565b565b5f7f436f756c64206e6f74207175657565206465706f736974000000000000000000910152565b611c536017602092610613565b611c5c81611c1f565b0190565b611c759060208101905f818303910152611c46565b90565b15611c7f57565b611c87610072565b62461bcd60e51b815280611c9d60048201611c60565b0390fd5b611caa9061146d565b90565b90959492611cf894611ce7611cf192611cdd608096611cd360a088019c5f890190610843565b6020870190610850565b6040850190610843565b6060830190610843565b0190610843565b565b611d2d6020611d17611d12611d0d61142e565b611461565b611479565b635445a29190611d25610072565b938492611485565b8252815f81611d3e600482016101d3565b03925af1908115611e76575f91611e48575b50611db05f8084611d8f8591611d80611d67610072565b938492600460208501630dddcea360e01b815201611bfc565b602082018103825203826100a2565b611d9761088f565b9082602082019151925af1611daa6108b6565b50611c78565b611dbc60608301610829565b611dc860408401610836565b91611dd560208501610836565b90611e43611de45f8701610829565b95611dfd60a0611df660808401610829565b9201610829565b90611e31611e2b7fb02d79c5657e344e23d91529b954c3087c60a974d598939583904a4f0b9596149761098a565b97611ca1565b97611e3a610072565b95869586611cad565b0390a3565b611e69915060203d8111611e6f575b611e6181836100a2565b81019061148b565b5f611d50565b503d611e57565b6114a9565b611e8490611b0e565b565b90611eba969594939291611eaa611ea5611e9f5f610711565b1561071e565b61077c565b611eb560015f6107cf565b6120bd565b611ec45f5f6107cf565b565b5190565b611ee9611ef2602093611ef793611ee081611ec6565b93848093610613565b95869101610cdf565b610084565b0190565b979694611f4d611f71979360c096611f40611f699760408e611f39611f2e611f5b9a60e08401908482035f860152610cea565b966020830190610843565b0190611587565b8b820360608d0152610cea565b9089820360808b0152611eca565b9087820360a0890152610cea565b940190610843565b565b60407f6c20756e7375636365737366756c000000000000000000000000000000000000917f4661696c656420746f2070726f64756365206d6573736167653a20707573685f5f8201527f666173745f66615f7769746864726177616c5f746f5f6f7574626f782063616c60208201520152565b611ff3604e606092610613565b611ffc81611f73565b0190565b6120159060208101905f818303910152611fe6565b90565b1561201f57565b612027610072565b62461bcd60e51b81528061203d60048201612000565b0390fd5b95939196949290966101008701975f880161205b91610850565b6020870161206891610850565b6040860161207591611587565b6060850161208291611587565b6080840161208f91610843565b60a0830161209c91610843565b60c082016120a991610843565b8082039060e001526120ba91610cea565b90565b959294939091946120e0866120da6120d45f6112ef565b916100e0565b1161138a565b6121278161210f84916121006120f4610072565b938492602084016113f9565b602082018103825203826100a2565b61212161211b82610ca0565b91611414565b2061141a565b9461215b602061214561214061213b61142e565b611461565b611479565b635445a29190612153610072565b938492611485565b8252815f8161216c600482016101d3565b03925af19081156123ca575f9161239c575b50938689899161218c610072565b9283926020840163d93ad06360e01b8152600401926121aa9361085d565b6020820181038252036121bd90826100a2565b6121c561088f565b6020820191515a925f8094938194f16121dc6108b6565b506121e69061155e565b9087929390869086926121f7610072565b9687966020880163164faff760e31b81526004019661221597611efb565b60208201810382520361222890826100a2565b6122306115db565b6020820191515a925f8094938194f16122476108b6565b9061225190612018565b61225a81610ca0565b6020820101906020019061226d91611702565b8391338791835f0161227e90611720565b9360200161228b90611720565b9588914291927f7e40c982e82bccb5e8bbd29f38bcfa3996f341ef9f51e2a9cffe086ec87a11c7976122bc9061098a565b986122c5610072565b9788976122d29789612041565b0390a2339190916122e1610072565b92839260208401635ae2fb3960e11b8152600401926122ff93610ca4565b60208201810382520361231290826100a2565b61231a610072565b918291602083016337d6e7b960e11b81526004019161233892610d1b565b60208201810382520361234b90826100a2565b612353610d41565b6020820191515a925f8094938194f161236a6108b6565b9061237490610d9e565b61237d81610ca0565b6020820101906020019061239091610e43565b5061239a906117e1565b565b6123bd915060203d81116123c3575b6123b581836100a2565b81019061148b565b5f61217e565b503d6123ab565b6114a9565b906123de969594939291611e86565b56fea26469706673582212208b81fd3d660d289a1aafa74d6f70cfed2af68b2d8960f44d209ec3bdfd16ce5c64736f6c634300081d0033";

pub(crate) const INTERNAL_FORWARDER_SOL_CONTRACT: &str = "0x60806040526004361015610010575b005b61001a5f35610029565b636fadcf720361000e57610197565b60e01c90565b60405190565b5f80fd5b5f80fd5b5f80fd5b60018060a01b031690565b61005590610041565b90565b6100618161004c565b0361006857565b5f80fd5b9050359061007982610058565b565b5f80fd5b5f80fd5b5f80fd5b909182601f830112156100c15781359167ffffffffffffffff83116100bc5760200192600183028401116100b757565b610083565b61007f565b61007b565b919091604081840312610107576100df835f830161006c565b92602082013567ffffffffffffffff8111610102576100fe9201610087565b9091565b61003d565b610039565b151590565b61011a9061010c565b9052565b5190565b60209181520190565b90825f9392825e0152565b601f801991011690565b61015f61016860209361016d936101568161011e565b93848093610122565b9586910161012b565b610136565b0190565b916101949261018760408201935f830190610111565b6020818403910152610140565b90565b346101c9576101b06101aa3660046100c6565b916103e5565b906101c56101bc61002f565b92839283610171565b0390f35b610035565b5f90565b606090565b600260ff60981b0190565b60209181520190565b60207f63616c6c65720000000000000000000000000000000000000000000000000000917f496e7465726e616c466f727761726465723a20756e617574686f72697a6564205f8201520152565b61024560266040926101e2565b61024e816101eb565b0190565b6102679060208101905f818303910152610238565b90565b1561027157565b61027961002f565b62461bcd60e51b81528061028f60048201610252565b0390fd5b906102c3949392916102be336102b86102b26102ad6101d7565b61004c565b9161004c565b1461026a565b6103b5565b9091565b905090565b90825f939282370152565b9091826102e7816102ee936102c7565b80936102cc565b0190565b90916102fd926102d7565b90565b634e487b7160e01b5f52604160045260245ffd5b9061031e90610136565b810190811067ffffffffffffffff82111761033857604052565b610300565b9061035061034961002f565b9283610314565b565b67ffffffffffffffff81116103705761036c602091610136565b0190565b610300565b9061038761038283610352565b61033d565b918252565b3d5f146103a75761039c3d610375565b903d5f602084013e5b565b6103af6101d2565b906103a5565b5f94919285949385925050926103d56103cc61002f565b938492836102f2565b03925af16103e161038c565b9091565b9061040192916103f36101ce565b6103fb6101d2565b90610293565b909156fea2646970667358221220e5f9fff4dec6f89c4d60d92ab32088a0288d8dc9fd51a7779569784ace69652464736f6c634300081d0033";

pub const SYSTEM_SOL_ADDR: Address = Address::ZERO;

pub const WITHDRAWAL_SOL_ADDR: Address = Address(FixedBytes::new([
    0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x01,
]));

pub const FA_BRIDGE_SOL_ADDR: Address = Address(FixedBytes::new([
    0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x02,
]));

pub const FEED_DEPOSIT_ADDR: Address = Address(FixedBytes::new([
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0xFE, 0xED,
]));

pub(crate) const WITHDRAWAL_SOL_CODE_HASH: FixedBytes<32> = FixedBytes::new([
    0x9e, 0x55, 0xd8, 0x00, 0x49, 0xdf, 0x77, 0x4a, 0xe0, 0x24, 0x7e, 0x25, 0xa8, 0x5f,
    0x6b, 0x46, 0x3a, 0xea, 0xa0, 0xc3, 0x5f, 0xe1, 0x44, 0x6e, 0x1e, 0xab, 0x07, 0x66,
    0x98, 0x2d, 0x91, 0x1e,
]);

pub(crate) const FA_BRIDGE_SOL_CODE_HASH: FixedBytes<32> = FixedBytes::new([
    0x72, 0x1f, 0xd4, 0x9d, 0x0a, 0x9b, 0x9a, 0x95, 0x01, 0xdf, 0xbc, 0xd8, 0x62, 0x9b,
    0xce, 0x1c, 0x80, 0xa6, 0x4d, 0x08, 0x9e, 0x91, 0x1e, 0x8b, 0x05, 0xf5, 0x32, 0x24,
    0x14, 0x41, 0x2e, 0xf3,
]);

pub(crate) const INTERNAL_FORWARDER_SOL_CODE_HASH: FixedBytes<32> = FixedBytes::new([
    0x9c, 0x9a, 0x44, 0x97, 0xe6, 0xc4, 0xe5, 0xe9, 0x30, 0x91, 0x7b, 0xa2, 0x34, 0xd2,
    0x42, 0x83, 0x83, 0xde, 0x03, 0xa4, 0xeb, 0x91, 0xf5, 0xf2, 0xf1, 0x35, 0x4d, 0x20,
    0xf1, 0x56, 0xc5, 0x3e,
]);

pub(crate) const SEND_OUTBOX_MESSAGE_PRECOMPILE_ADDRESS: Address =
    Address(FixedBytes::new([
        0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03,
    ]));

pub(crate) const TABLE_PRECOMPILE_ADDRESS: Address = Address(FixedBytes::new([
    0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x04,
]));

pub(crate) const GLOBAL_COUNTER_PRECOMPILE_ADDRESS: Address = Address(FixedBytes::new([
    0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x05,
]));

pub(crate) const CHANGE_SEQUENCER_KEY_PRECOMPILE_ADDRESS: Address =
    Address(FixedBytes::new([
        0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x06,
    ]));

#[cfg(test)]
pub(crate) const PRECOMPILE_BURN_ADDRESS: Address = Address(FixedBytes::new([
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0xde, 0xad,
]));

pub(crate) const CUSTOMS: [Address; 6] = [
    WITHDRAWAL_SOL_ADDR,
    FA_BRIDGE_SOL_ADDR,
    SEND_OUTBOX_MESSAGE_PRECOMPILE_ADDRESS,
    TABLE_PRECOMPILE_ADDRESS,
    GLOBAL_COUNTER_PRECOMPILE_ADDRESS,
    CHANGE_SEQUENCER_KEY_PRECOMPILE_ADDRESS,
];

// Rationale regarding the cost:
// A few decoding/encoding functions.
pub(crate) const SEND_OUTBOX_MESSAGE_BASE_COST: u64 = 500;

// Rationale regarding the cost:
// Covers the cost of 2 r/w access on cold keys.
// In particular, worst case for a cold read 2100 + the worst case for
// cold write 22100 (inserting a non zero value to a zero value).
pub(crate) const TICKET_TABLE_BASE_COST: u64 = 24_200;

// Rationale regarding the cost:
// Covers the cost of 2 r/w access on cold keys.
// In particular, worst case for a cold read 2100 + the worst case for
// cold write 22100 (inserting a non zero value to a zero value).
pub(crate) const GLOBAL_COUNTER_BASE_COST: u64 = 24_200;

// Rationale regarding the cost:
// Covers the cost of 2 r/w access on cold keys.
// In particular, worst case for a cold read 2100 + the worst case for
// cold write 22100 (inserting a non zero value to a zero value).
pub(crate) const UPGRADE_SEQUENCER_PRECOMPILE_BASE_COST: u64 = 24_200;

// Rationale regarding the cost:
// Consumed gas is ~81000 for both queue execute_without_proxy entrypoints
pub const FA_DEPOSIT_EXECUTION_COST: u64 = 100_000;

pub const FA_DEPOSIT_QUEUE_GAS_LIMIT: u64 = 0;

/// Overapproximation of the amount of ticks for parsing FA deposit.
/// Also includes hashing costs.
///
/// Obtained by running the `bench_fa_deposit` and examining both
/// `hashing_ticks` and `signature_verification_ticks` (parsing).
/// The final value is maximum total plus +50% reserve.
///
/// NOTE that we have a hard cap because of the maximum inbox message size limitation.
/// If it is lifted at some point in the future, we need to reflect that.
pub const TICKS_PER_FA_DEPOSIT_PARSING: u64 = 3_500_000;

pub(crate) const SEQUENCER_UPGRADE_DELAY: u64 = 60 * 60 * 24; // 24 hours

#[cfg(test)]
mod test {
    use super::{
        FA_BRIDGE_SOL_CODE_HASH, FA_BRIDGE_SOL_CONTRACT,
        INTERNAL_FORWARDER_SOL_CODE_HASH, INTERNAL_FORWARDER_SOL_CONTRACT,
        WITHDRAWAL_SOL_CODE_HASH, WITHDRAWAL_SOL_CONTRACT,
    };

    use crate::helpers::storage::bytes_hash;
    use revm::{
        primitives::{hex::FromHex, Bytes, FixedBytes},
        state::Bytecode,
    };

    fn check_code_hash_validity(code: &str, code_hash_voucher: FixedBytes<32>) {
        let bytecode = Bytecode::new_legacy(Bytes::from_hex(code).unwrap());
        let code_hash = bytes_hash(bytecode.original_byte_slice());
        // Keep this until the script is updated
        println!(
            "{:?}",
            code_hash
                .iter()
                .map(|e| format!("0x{e:02x}"))
                .collect::<Vec<String>>()
                .join(", ")
        );
        assert_eq!(code_hash, code_hash_voucher)
    }

    #[test]
    fn check_withdrawal_sol_code_hash() {
        check_code_hash_validity(WITHDRAWAL_SOL_CONTRACT, WITHDRAWAL_SOL_CODE_HASH)
    }

    #[test]
    fn check_fa_bridge_sol_code_hash() {
        check_code_hash_validity(FA_BRIDGE_SOL_CONTRACT, FA_BRIDGE_SOL_CODE_HASH)
    }

    #[test]
    fn check_internal_forwarder_sol_code_hash() {
        check_code_hash_validity(
            INTERNAL_FORWARDER_SOL_CONTRACT,
            INTERNAL_FORWARDER_SOL_CODE_HASH,
        )
    }
}
